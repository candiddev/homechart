import{S as l,c as a,b3 as d,m as u,b4 as t,A as g,ap as D,a$ as M,ab as A,b5 as c,az as h,I as m,b6 as y,b7 as b,ah as v,ai as T,a8 as N,aw as S,b8 as B,aN as k,T as i,D as n,b9 as O,ay as s,ba as $,au as F,aC as R,bb as w,bc as G,bd as _,a as H,b2 as p}from"./index-09c2e996.js";import{F as W}from"./Filter-01c23926.js";import{T as j}from"./TitleTabsAuthHouseholds-59423851.js";import{G as q}from"./GetHelp-610c77dd.js";function Y(){const r={collapsedCategories:l([a.translate(d)]),columns:l({budgetCategoryName:"",amount:"",budgetTransactionAmount:"",balance:"",budgetCategoryTargetAmount:""}),householdID:a.data().primaryAuthHouseholdID,loaded:!1,picker:"",yearMonthPretty:""},C=l.lift((e,o,f)=>(u.redraw(),W.array(e.budgetMonthCategories.filter(I=>!o.includes(I.budgetCategory.grouping)),f,{})),t.data,r.collapsedCategories,r.columns);return g.getSessionDisplay()===1&&r.columns({budgetCategoryName:"",amount:"",budgetTransactionAmount:"",balance:""}),g.getSessionDisplay()===0&&r.columns({budgetCategoryName:"",amount:"",balance:""}),{oninit:async()=>(r.loaded=!1,p.spanStart("BudgetCategories"),g.setLayoutApp({...q("budget"),breadcrumbs:[{link:"/budget/accounts",name:a.translate(D)},{name:a.translate(M)}],toolbarActionButtons:[A().newBudgetCategory]}),u.route.param().household===void 0?u.route.param().household=r.householdID:r.householdID=u.route.param().household,parseInt(u.route.param().yearMonth,10)>=201801?t.yearMonth=c.fromNumber(parseInt(u.route.param().yearMonth,10)):t.yearMonth=h.now().toYearMonth(),t.data().yearMonth===h.now().toYearMonth().toNumber()&&await t.load().then(async e=>{t.data(e)}),t.read(r.householdID).then(()=>{p.spanEnd("BudgetCategories"),r.loaded=!0,u.redraw()})),view:()=>u(H,{actions:[{icon:m.Budget,name:a.translate(y),onclick:async()=>(t.data().budgetMonthCategories!==null&&t.data().budgetMonthCategories.map(async e=>{if(!(e.budgetCategory.grouping===""||e.budgetCategory.grouping===a.translate(d)))return e.amount=b.targetAmount(e,t.yearMonth.toNumber()),e.yearMonth===t.yearMonth.toNumber()?b.update(e):(e.yearMonth=t.yearMonth.toNumber(),b.create(e))}),t.read(r.householdID)),permitted:v.permitted(T.Budget,!0),requireOnline:!0}],data:C(),editOnclick:e=>{const o=N(e);o.id=e.budgetCategoryID,o.authHouseholdID=r.householdID,o.id===null&&(o.id=S.new(),o.grouping=!0),g.setLayoutAppForm(B,o)},filters:[],getKey:e=>`${e.budgetCategory.grouping}${e.budgetCategory.name}`,loaded:r.loaded,noFilters:!0,tableColumns:[{collapsedNames:r.collapsedCategories(),formatter:e=>e.budgetCategory.name,linkFormatter:e=>`/budget/transactions?category=${e.budgetCategoryID}`,linkRequireOnline:!0,name:a.translate(k),onclick:e=>{const o=r.collapsedCategories();r.collapsedCategories().includes(e)?o.splice(o.indexOf(e),1):o.push(e),r.collapsedCategories(o)},property:"budgetCategoryName",typeCheck:e=>e.budgetCategory.grouping===""?i.Collapsible:i.Link},{currencyFormat:n.findID(r.householdID).preferences.currency,formatter:e=>e.budgetCategory.income||e.budgetCategory.grouping===""&&e.budgetCategory.name===a.translate(d)||e.budgetCategory.grouping===a.translate(d)?"":e.budgetCategory.name!=="Hidden"&&(e.yearMonth===t.yearMonth.toNumber()||e.budgetCategory.grouping==="")?e.amount:0,name:a.translate(O),property:"amount",type:i.Currency},{currencyFormat:n.findID(r.householdID).preferences.currency,formatter:e=>e.budgetCategory.grouping===""?e.budgetCategory.name===a.translate(d)?"":e.budgetTransactionAmount:s.toString(e.yearMonth===t.yearMonth.toNumber()?e.budgetTransactionAmount:0,n.findID(r.householdID).preferences.currency),linkFormatter:e=>`/budget/transactions?category=${e.budgetCategoryID}&month=${t.yearMonth.toNumber()}`,linkRequireOnline:!0,name:a.translate($),positive:e=>e.budgetTransactionAmount===void 0?!0:e.budgetTransactionAmount>=0,property:"budgetTransactionAmount",rightAlign:!0,typeCheck:e=>e.budgetCategory.grouping===""?i.Currency:i.Link},{currencyFormat:n.findID(r.householdID).preferences.currency,formatter:e=>e.budgetCategory.income||e.budgetCategory.grouping===""&&e.budgetCategory.name===a.translate(d)?"":e.balance,name:a.translate(F),property:"balance",type:i.Currency},{currencyFormat:n.findID(r.householdID).preferences.currency,formatter:e=>e.budgetCategory.grouping===""||R.findID(e.budgetCategoryID).income?"":e.budgetCategory.targetAmount,name:a.translate(y),property:"budgetCategoryTargetAmount",type:i.Currency}],tableColumnsNameEnabled:r.columns,title:{buttonLeft:{href:`/budget/categories/${c.fromNumber(t.yearMonth.toNumber()).addMonths(-1).toNumber()}?household=${r.householdID}`,icon:m.Previous,name:c.fromNumber(t.yearMonth.toNumber()).addMonths(-1).toString(),permitted:!0,requireOnline:!0},buttonRight:{href:`/budget/categories/${t.yearMonth.addMonths(1).toNumber()}?household=${r.householdID}`,icon:m.Next,iconRight:!0,name:t.yearMonth.addMonths(1).toString(),permitted:!0,requireOnline:!0},name:t.yearMonth.toString(),subtitles:[{color:t.data().budgetTransactionAmountIncomeRemaining+t.data().budgetMonthCategoryAmount-t.data().budgetTransactionAmountIncome<0?"var(--color_negative)":"var(--color_positive)",key:`${a.translate(w)}:`,value:t.data().yearMonth===t.yearMonth.toNumber()?s.toString(t.data().budgetTransactionAmountIncomeRemaining+t.data().budgetMonthCategoryAmount-t.data().budgetTransactionAmountIncome,n.findID(r.householdID).preferences.currency):s.toString(t.data().budgetTransactionAmountIncomeRemaining,n.findID(r.householdID).preferences.currency)},{color:t.data().yearMonth===t.yearMonth.toNumber()&&t.data().budgetTransactionAmountIncome<0?"var(--color_negative)":"var(--color_positive)",key:`${a.translate(G)}:`,value:t.data().yearMonth===t.yearMonth.toNumber()?s.toString(t.data().budgetTransactionAmountIncome,n.findID(r.householdID).preferences.currency):s.toString(0,n.findID(r.householdID).preferences.currency)},{color:-1*t.data().budgetMonthCategoryAmount<0?"var(--color_negative)":"var(--color_positive)",key:"Budgeted:",value:t.data().yearMonth===t.yearMonth.toNumber()?s.toString(t.data().budgetMonthCategoryAmount*-1,n.findID(r.householdID).preferences.currency):s.toString(0,n.findID(r.householdID).preferences.currency)},{color:t.data().budgetTransactionAmountIncomeRemaining<0?"var(--color_negative)":"var(--color_positive)",key:`${a.translate(_)}:`,value:s.toString(t.data().budgetTransactionAmountIncomeRemaining,n.findID(r.householdID).preferences.currency)}],tabs:j()}})}}export{Y as BudgetCategories};
