import{S as x,V as v,C as y,A as d,D as i,dt as W,c as t,du as h,m as u,a0 as p,F as I,dv as g,cX as T,I as b,dw as S,dx as w,dy as A,dz as O,r as C,t as F,b as G,q as L,T as D,dA as q,dB as H,a as R}from"./index-09c2e996.js";import{T as $}from"./TitleTabsAuthHouseholds-59423851.js";import{G as E}from"./GetHelp-610c77dd.js";const l={data:x([]),delete:async()=>v.delete("/api/v1/admin/feature-votes").then(r=>{if(y(r))return r;d.setLayoutAppAlert({message:"Feature Votes Deleted"})}),read:async()=>v.read("/api/v1/admin/feature-votes",{}).then(r=>{if(y(r))return r;i.inResponseFeatureVotes(r)&&l.data(r.dataValue)})};function j(){const r=x({description:"",amount:"",comment:""}),a={data:i.newFeatureVote(),visible:!1},f=W.data.map(e=>e.featureVotes!==void 0?e.featureVotes:[]);let s=t.data().primaryAuthHouseholdID;return{oninit:async()=>{if(d.setLayoutApp({...E(),breadcrumbs:[{name:t.translate(h)}],toolbarActionButtons:[]}),u.route.param().household===void 0?u.route.param().household=s:s=u.route.param().household,d.isSessionAdmin()&&(await l.read(),u.redraw()),d.getSessionDisplay()<2&&r({description:"",amount:""}),Object.keys(r()).length===0)switch(d.getSessionDisplay()){case p.XLarge:r({image:"",name:"",created:"",time:"",rating:"",cookScheduleLast:"",cookScheduleCount:""});break;case p.Large:r({image:"",name:"",created:"",time:"",rating:"",cookScheduleLast:""});break;case p.Medium:case p.Small:case p.XSmall:r({image:"",name:"",rating:""});break}},view:()=>[a.visible?u(G,{buttons:[{name:t.translate(C),onclick:async()=>{a.visible=!1},permitted:!0,requireOnline:!0},{name:t.translate(F),onclick:async()=>{const e=i.findID(s),o=e.featureVotes.findIndex(n=>n.feature===a.data.feature);return o<0?e.featureVotes.push(a.data):e.featureVotes[o]=a.data,i.update(e).then(()=>{a.visible=!1})},permitted:!0,primary:!0,requireOnline:!0}],overlay:!0,title:{name:`${t.translate(F)} ${t.translate(h)}`}},[u(I,{input:{disabled:!0,oninput:()=>{},type:"text",value:f()[a.data.feature]},name:t.translate(g),tooltip:""}),u(T,{iconSelect:b.RatingSelect,iconUnselect:b.RatingUnselect,max:5-i.findID(s).featureVotes.map(e=>e.feature===a.data.feature?0:e.amount).reduce((e,o)=>e+o,0),name:t.translate(S),onclick:e=>{a.data.amount=e},tooltip:t.translate(w),value:a.data.amount}),u(I,{name:t.translate(A),textArea:{oninput:e=>{a.data.comment=e},value:a.data.comment},tooltip:t.translate(O)})]):[],u(R,{actions:[{accent:!0,icon:b.Delete,name:t.translate(L),onclick:async()=>l.delete().then(async()=>l.read()).then(async()=>{u.redraw()}),permitted:d.isSessionAdmin(),requireOnline:!0}],data:f(),editOnclick:e=>{const o=f().indexOf(e),n=i.findID(s).featureVotes.findIndex(m=>m.feature===o);n<0?(a.data=i.newFeatureVote(),a.data.feature=o):a.data=i.findID(s).featureVotes[n],a.visible=!0},filters:[],getKey:e=>e,loaded:!0,noFilters:!0,tableColumns:[{formatter:e=>e,name:t.translate(g),noFilter:!0,property:"description"},{formatter:e=>{const o=f().indexOf(e);let n=0;if(d.isSessionAdmin()){const c=l.data().findIndex(k=>k.feature===o);return l.data()[c]!==void 0&&(n=l.data()[c].amount),`${n}`}const m=i.findID(s).featureVotes.findIndex(c=>c.feature===o);i.findID(s).featureVotes[m]!==void 0&&(n=i.findID(s).featureVotes[m].amount);let V="";for(let c=1;c<6;c++)c<=n&&(V+=`${b.RatingSelect} `);return V},name:t.translate(S),noFilter:!0,property:"amount",type:d.isSessionAdmin()?D.Text:D.Icon},{formatter:e=>{const o=f().indexOf(e);if(d.isSessionAdmin()){const n=l.data().findIndex(m=>m.feature===o);if(l.data()[n]!==void 0)return l.data()[n].comment}else{const n=i.findID(s).featureVotes.findIndex(m=>m.feature===o);if(i.findID(s).featureVotes[n]!==void 0)return i.findID(s).featureVotes[n].comment}return""},name:t.translate(A),noFilter:!0,property:"comment"}],tableColumnsNameEnabled:r,title:{subtitles:[{key:"",value:t.translate(q)},{key:"",value:t.translate(H)}],tabs:$()}})]}}export{j as FeatureVoting};
