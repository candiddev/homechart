import{aA as p,e2 as u,m as a,aY as m,A as n,ee as c,ef as f,by as d,I as g,eg as v,b}from"./index-09c2e996.js";let o;const l={getHeaders:async r=>{const e=await l.import(r);return e===null||e.meta.fields===void 0?[]:e.meta.fields},import:async r=>{o===void 0&&(o=await p(()=>import("./papaparse.min-81dbec36.js").then(t=>t.p),["assets/papaparse.min-81dbec36.js","assets/index-09c2e996.js","assets/index-5446acb6.css"]));const e=o.parse(r.split(`
`).filter(t=>t.includes(",")).join(`
`),{header:!0});return e.errors.length>0?(e.errors.map(t=>{u(`CSV.import error: ${t.message}`)}),null):e}};function I(){const r={csv:"",headers:[]};return{view:e=>e.attrs.visible?a(b,{buttons:[{name:n.preferences().translations.actionCancel,onclick:async()=>new Promise(t=>(r.csv="",e.attrs.toggle(!1),t())),permitted:!0,requireOnline:!0},{name:n.preferences().translations.actionImport,permitted:r.csv!=="",requireOnline:!0,submit:!0}],onsubmit:async()=>e.attrs.onsubmit(r.csv).then(()=>{e.attrs.toggle(!1)}),overlay:!0,title:{name:e.attrs.title}},[a(m,{name:n.preferences().translations.formImportCSVSelectCSV,oninput:async t=>{const i=new FileReader;i.onload=async()=>{if(typeof i.result=="string"){r.csv=i.result,r.headers=await l.getHeaders(r.csv);for(const s of r.headers)if(Object.keys(e.attrs.fields).includes(s)){e.attrs.oninput(s,s),a.redraw();continue}else e.attrs.merge===!0&&e.attrs.oninput(s,s);a.redraw()}},i.readAsText(t)},permitted:r.csv==="",primary:!0,requireOnline:!0}),e.attrs.buttons!==void 0&&r.csv===""?e.attrs.buttons.map(t=>a(m,t)):[],r.csv===""?[]:a("div.FormItem",{id:"form-item-csv-field-mapping"},[a("div.FormItem__label",[a("label",{for:"form-item-input-csv-field-mapping",id:"form-item-label-csv-field-mapping"},n.preferences().translations.formImportCSVField),a(c,{value:n.preferences().translations.formImportCSVTooltip})]),Object.keys(e.attrs.fields).map((t,i)=>a("div.FormItem__multi",{key:i,style:{"flex-wrap":"nowrap"}},[a(f,{disabled:!0,name:`csv-field-mapping-${t}-name`,type:"text",value:t}),a(d,{icon:g.Mapping}),a(v,{name:`csv-field-mapping-${t}-value`,oninput:s=>{e.attrs.oninput(t,s)},options:["",...r.headers],value:e.attrs.fields[t]})]))])]):[]}}export{l as C,I as F};
