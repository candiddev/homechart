import{S as i,dj as m,A as f,m as d,a as h,c as r,s as l,ah as u,ai as c,T as b,af as k,dk as g,aN as D,ax as w,dl as P,ct as A,d2 as C,r as y,dm as p,dn as O,dp as F,bB as v,dq as $,b as I,dr as q,q as x,t as W,aw as T,ds as j}from"./index-09c2e996.js";import{F as G}from"./Filter-01c23926.js";function N(){const e={columns:i({add:"",name:"",shopCategoryID:""}),data:i([]),form:{data:m.new(),visible:!1},sort:i({invert:!1,property:"name"})};f.getSessionDisplay()>1&&(e.columns=i({add:"",name:"",shopCategoryID:"",cookRecipeID:""}));const S=i.lift((n,t,a)=>G.array(t,n,a),e.columns,e.data,e.sort);return{view:n=>n.attrs.visible?[d(I,{buttons:[{name:r.translate(y),onclick:async()=>new Promise(t=>(n.attrs.toggle(!1),t())),permitted:!0,requireOnline:!0},{name:`${r.translate(l)} ${r.translate(p)}`,onclick:async()=>new Promise(t=>(e.form.data=m.new(),e.form.visible=!0,t())),permitted:u.permitted(c.Shop,!0),primary:!0,requireOnline:!0},{name:r.translate(O),onclick:async()=>new Promise(t=>(e.data().map(async a=>{a.add===!0&&(delete a.add,a.id=null,await m.create(a,!0),f.setLayoutAppAlert({message:r.translate(F)}))}),n.attrs.toggle(!1),t())),permitted:u.permitted(c.Shop,!0),primary:!0,requireOnline:!0}],oninit:()=>{e.data(v.toShopItems(n.attrs.cookMealPlans)),d.redraw()},overlay:!0,title:{name:r.translate($)}},d(h,{actions:[],data:S(),editOnclick:t=>{e.form.data=t,e.form.visible=!0},filters:[],loaded:!0,noNewButton:!0,sort:e.sort,tableColumns:[{checkboxOnclick:async t=>new Promise(a=>{const o=e.data().findIndex(s=>s.id===t.id);return e.data()[o].add=t.add!==!0,a()}),name:`${r.translate(l)}?`,permitted:t=>u.permitted(c.Shop,!0,t.authHouseholdID),property:"add",type:b.Checkbox},{name:r.translate(k),property:"name"},{formatter:t=>g.findID(t.shopCategoryID).name,name:r.translate(D),property:"shopCategoryID"},{formatter:t=>w.findID(t.budgetPayeeID).name,linkFormatter:t=>`/shop/items?store=${t.budgetPayeeID}`,name:r.translate(P),property:"shopStoreID",type:b.Link},{formatter:t=>A.findID(t.cookRecipeID).name,name:r.translate(C),property:"cookRecipeID"}],tableColumnsNameEnabled:e.columns})),e.form.visible?d(I,{buttons:[{accent:!0,name:r.translate(x),onclick:async()=>new Promise(t=>{const a=e.data(),o=a.findIndex(s=>s.id===e.form.data.id);return a.splice(o,1),e.data(a),e.form.visible=!1,t()}),permitted:e.form.data.id!==null,requireOnline:!0},{name:r.translate(y),onclick:async()=>new Promise(t=>(e.form.visible=!1,t())),permitted:!0,requireOnline:!0},{name:`${e.form.data.id===null?r.translate(l):r.translate(W)} ${r.translate(p)}`,permitted:!0,requireOnline:!0,submit:!0}],onsubmit:async()=>new Promise(t=>{if(e.form.data.id===null){e.form.data.add=!0,e.form.data.id=T.new();const a=e.data();a.push(e.form.data),e.data(a)}else{const a=e.data(),o=a.findIndex(s=>s.id===e.form.data.id);a[o]=e.form.data,e.data(a)}return e.form.visible=!1,t()}),overlay:!0,title:{name:`${r.translate(l)} ${r.translate(j)} ${r.translate(p)}`}},d(q,{data:e.form.data})):[]]:[]}}export{N as F};
