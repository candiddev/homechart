import{bq as O,br as T,m as r,F as u,c as e,af as K,cf as W,fj as d,ah as s,ai as i,fk as C,S as F,b as y,fl as q,fm as D,fn as G,fo as B,A as c,az as I,fp as R,r as m,fq as E,fr as L,fs as N,ft as k,k as Q,fu as x,a as H,fv as U,fw as $,bQ as j,j as f,fx as V,aY as z,t as P,fy as M,cM as J,fz as Y,fA as X,fB as Z,fC as _,fD as ee,fE as te,fF as ae,g as re,fG as ne,fH as se,C as v,fI as A,fJ as ie,fK as h,fL as oe,fM as ue,D as p,fN as S,fO as ce,fP as le,fQ as me,fR as pe,v as de,I as be,fS as ye,b2 as fe,fT as Pe}from"./index-09c2e996.js";import{F as b}from"./FormItemNewPassword-12d871a8.js";import{F as ve}from"./FormAuthAccountPreferences-03eff0ee.js";import{O as Ae}from"./OIDCButtons-0f7ed6f9.js";import{T as he}from"./TableComponents-d4e0ba42.js";import{P as Se}from"./Payment-7ef1bf2a.js";import{G as Ke}from"./GetHelp-610c77dd.js";function w(){const a={password:"",passwordConfirm:"",passwordShow:!1};return{onbeforeremove:O.onbeforeremove(T.FromRight),view:t=>r(C,{buttons:[],data:t.attrs.data,name:e.translate(d),onDelete:async()=>e.deletePrivateKey(t.attrs.data.name),onSubmit:async()=>{if(a.password!==""){const o=await e.newPrivateKeyPBKDF2(a.password);o!==void 0&&(t.attrs.data.key=o)}return e.setPrivateKey(t.attrs.data)},permitted:s.permitted(i.Auth)},[r(u,{input:{oninput:o=>{t.attrs.data.name=o},required:!0,type:"text",value:t.attrs.data.name},name:e.translate(K),tooltip:e.translate(W)}),r(b,{name:e.translate(d),noAutocomplete:!0,oninput:o=>{a.password=o},value:()=>a.password})])}}function l(){c.setLayoutApp({...Ke("/using-homechart/platform/settings#account",!0),breadcrumbs:[{link:"/settings/account",name:e.translate(pe)},{name:e.translate(de)}],toolbarActionButtons:e.privateKey()===""?[]:[{icon:be.SecretsValue,name:e.translate(k),onclick:()=>{c.setLayoutAppForm(w,{id:null,key:"",name:"",provider:ye})},permitted:s.permitted(i.Auth,!0),requireOnline:!0}]})}function Fe(){let a=e.data();const t={delete:!1,deleteFeedback:{emailAddress:e.data().emailAddress,message:"",type:1,url:""},erasePrivateKey1:!1,erasePrivateKey2:!1,erasePrivateKey3:!1,formPasswordShow:!1,passphrase:"",rememberPassphrase:!0,tab:0},o=F({name:""});return{oninit:async()=>{fe.spanStart("SettingsAccount"),r.route.param().security!==void 0&&(t.tab=2),l(),a=e.data()},onremove:async()=>e.load().then(()=>{r.redraw()}),view:()=>[r(y,{buttons:t.tab===0?[{name:e.translate(te),onclick:async()=>e.readVerify(),permitted:s.permitted(i.Auth,!0)&&!e.data().verified&&!e.data().child,requireOnline:!0},{name:e.translate(P),permitted:s.permitted(i.Auth,!0),requireOnline:!0,submit:!0}]:t.tab===2?[{accent:!0,name:`${e.translate(ae)} ${re.values[e.data().oidcProviderType]}`,onclick:async()=>new Promise(n=>(t.formPasswordShow=!0,n())),permitted:s.permitted(i.Auth,!0)&&e.data().oidcProviderType!==0&&!t.formPasswordShow,requireOnline:!0},{accent:!0,name:e.translate(ne),onclick:async()=>e.updateTOTP({...e.data(),totpSecret:""}).then(()=>{a.totpBackup=""}),permitted:s.permitted(i.Auth,!0)&&e.data().totpEnabled===!0,requireOnline:!0},{name:e.translate(se),onclick:async()=>e.readTOTPBackup().then(n=>{v(n)||(a.totpBackup=n)}),permitted:s.permitted(i.Auth,!0)&&e.data().totpEnabled===!0,requireOnline:!0,secondary:a.totpBackup!==""},{name:e.translate(A),onclick:async()=>e.createTOTP().then(n=>{v(n)||(a.totpQR=n.totpQR,a.totpSecret=n.totpSecret)}),permitted:s.permitted(i.Auth,!0)&&e.data().totpEnabled!==!0&&a.totpSecret===""&&e.data().oidcProviderType===ie.None,primary:!0,requireOnline:!0},{name:e.translate(m),onclick:async()=>{a.totpQR="",a.totpSecret=""},permitted:s.permitted(i.Auth,!0)&&a.totpSecret!=="",requireOnline:!0},{name:e.translate(A),onclick:async()=>e.updateTOTP(a).then(()=>{a.totpCode="",a.totpQR="",a.totpSecret=""}),permitted:s.permitted(i.Auth,!0)&&a.totpSecret!=="",primary:!0,requireOnline:!0}]:t.tab===3?[{accent:!t.delete,name:t.delete?e.translate(m):e.translate(h),onclick:async()=>new Promise(n=>(t.delete=!t.delete,n())),permitted:s.permitted(i.Auth,!0),requireOnline:!0},{accent:!0,name:e.translate(oe),onclick:async()=>(t.deleteFeedback.message!==""&&await ue.create(t.deleteFeedback),Pe.reset(),p.members().filter(g=>g.child===!1).length===1&&p.findID(e.data().primaryAuthHouseholdID).subscriptionProcessor!==S.None&&p.findID(e.data().primaryAuthHouseholdID).subscriptionProcessor!==S.PaddleLifetime&&await Se.cancel(e.data().primaryAuthHouseholdID),e.delete().then(async()=>s.signOut())),permitted:s.permitted(i.Auth,!0)&&t.delete,requireOnline:!0}]:[],onsubmit:async()=>{switch(t.tab){case 0:return e.update(a);case 2:return c.setComponentsButtonLoading("Update Password"),e.update(a).then(()=>{a.password="",r.redraw()});default:return}},title:{tabs:[{active:t.tab===0,name:e.translate(ce),onclick:()=>{t.tab=0}},{active:t.tab===1,name:e.translate(le),onclick:()=>{t.tab=1}},...e.data().child?[]:[{active:t.tab===2,name:e.translate(me),onclick:()=>{t.tab=2}},{active:t.tab===3,name:e.translate(h),onclick:()=>{t.tab=3}}]]}},t.tab===0?[r(ve,{authAccount:a})]:t.tab===1?r(he):t.tab===2?[e.privateKey()===""?r(y,{buttons:[{accent:!0,name:e.translate(q),onclick:async()=>{t.erasePrivateKey1=!0},permitted:e.data().publicKey!==""&&!t.erasePrivateKey1,requireOnline:!1},{name:e.data().publicKey===""?e.translate(D):e.translate(G),onclick:async()=>e.data().publicKey===""?e.newPrivatePublicKey(`${e.translate(B)} ${c.formatCivilDate(I.now())}`,t.passphrase).then(()=>{l()}):e.decryptPrivateKeys(t.passphrase).then(async()=>{if(e.privateKey()==="")c.setLayoutAppAlert({message:e.translate(R)});else if(l(),t.rememberPassphrase)return e.savePrivateKey()}),permitted:!0,primary:!0,requireOnline:!1},{name:e.translate(m),onclick:async()=>{t.erasePrivateKey1=!1,t.erasePrivateKey2=!1,t.erasePrivateKey3=!1},permitted:t.erasePrivateKey1,primary:!0,requireOnline:!1},{accent:!0,name:t.erasePrivateKey3?e.translate(E):t.erasePrivateKey2?e.translate(L):e.translate(N),onclick:async()=>{if(t.erasePrivateKey2===!1){t.erasePrivateKey2=!0;return}if(t.erasePrivateKey3===!1){t.erasePrivateKey3=!0;return}return e.updatePrivatePublicKeys({...e.data(),privateKeys:[],publicKey:""}).then(()=>{t.erasePrivateKey1=!1,t.erasePrivateKey2=!1,t.erasePrivateKey3=!1,l()})},permitted:t.erasePrivateKey1,requireOnline:!1}],title:{name:e.translate(k)}},[r(b,{name:e.translate(d),noAutocomplete:!0,noConfirm:e.data().publicKey!=="",noNew:e.data().publicKey!=="",oninput:n=>{t.passphrase=n},value:()=>t.passphrase}),r(Q,{name:e.translate(x),onclick:()=>{t.rememberPassphrase=!t.rememberPassphrase},value:t.rememberPassphrase})]):r(H,{actions:e.privateKey()===""?[]:[{accent:!0,name:e.translate(U),onclick:async()=>(e.privateKey(""),e.savePrivateKey()),permitted:!0,requireOnline:!1}],data:e.keys(),editOnclick:n=>{c.setLayoutAppForm(w,n)},filters:[],loaded:!0,noFilters:!0,staticColumns:!0,tableColumns:[{name:e.translate(K),property:"name"}],tableColumnsNameEnabled:o,title:{name:e.translate($)}}),e.data().oidcProviderType===0||t.formPasswordShow?[r(j,{name:e.translate(f)}),r(u,{hidden:!0,input:{autocomplete:"username",hidden:!0,oninput:()=>{},type:"email",value:a.emailAddress},name:e.translate(V),tooltip:""}),r(b,{name:e.translate(f),oninput:n=>{a.password=n},value:()=>a.password}),r(z,{name:e.translate(P),permitted:s.permitted(i.Auth,!0)&&e.data().oidcProviderType===0||t.formPasswordShow,requireOnline:!0,submit:!0}),e.data().oidcProviderType===0?r(Ae,{disabled:!1}):[],[a.totpBackup===""?[]:r(u,{input:{disabled:!0,inputmode:"numeric",oninput:()=>{},type:"text",value:a.totpBackup},name:e.translate(M),tooltip:""}),a.totpQR===""?[]:r(J,{disabled:!0,name:e.translate(Y),oninput:()=>{},value:`data:image/png;base64, ${a.totpQR}`}),a.totpSecret===""?[]:[r(u,{input:{disabled:!0,oninput:()=>{},type:"text",value:a.totpSecret},name:e.translate(X),tooltip:""}),r(u,{input:{inputmode:"numeric",oninput:n=>{a.totpCode=n},type:"text",value:a.totpCode},name:e.translate(Z),tooltip:e.translate(_)})]]]:[]]:t.tab===3?[r(u,{name:`${e.translate(ee)}?`,textArea:{oninput:n=>{t.deleteFeedback.message=n},value:t.deleteFeedback.message},tooltip:""})]:[])]}}export{Fe as SettingsAccount};
