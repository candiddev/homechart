import{eB as H,S as u,A as d,c as t,fR as v,gX as I,I as c,gY as b,ah as i,ai as l,m as r,F as G,af as h,cf as W,G as k,U as S,Z as y,az as O,gZ as P,fY as g,al as $,gK as A,D as T,q as x,r as q,s as D,t as w,u as E,o as n,eC as F,b as N,g_ as B,g$ as U,b2 as p,h0 as j,T as f,y as K,a as Y,C as Z}from"./index-09c2e996.js";import{F as C}from"./FormPermissions-29833505.js";import{G as _}from"./GetHelp-610c77dd.js";function M(){const s=new H,e={columns:u({name:"",created:"",expires:""}),expandHousehold:"",expandPersonal:!1,form:{data:s.new(),deleteConfirm:!1,visible:!1},loaded:!1,sessions:u([]),sort:u({invert:!0,property:"created"})};async function m(){const a=await n.readAll();Z(a)||(e.sessions(a),r.redraw())}return{oninit:async()=>(e.loaded=!1,p.spanStart("SettingsSessions"),d.setLayoutApp({..._("/using-homechart/platform/settings#sessions",!0),breadcrumbs:[{link:"/settings/account",name:t.translate(v)},{name:t.translate(I)}],toolbarActionButtons:[{icon:c.Session,name:t.translate(b),onclick:()=>{e.form.data=s.new(),e.form.visible=!0},permitted:i.permitted(l.Auth,!0),requireOnline:!0}]}),m().then(()=>{e.loaded=!0,p.spanEnd("SettingsSessions")})),view:()=>[e.form.visible?r(N,{buttons:[{accent:!0,name:t.translate(x),onclick:async()=>new Promise(a=>(e.form.deleteConfirm=!0,a())),permitted:!0,requireOnline:i.permitted(l.Auth,!0)&&e.form.data.id!==null&&!e.form.deleteConfirm},{name:t.translate(q),onclick:async()=>new Promise(a=>(e.form.deleteConfirm?e.form.deleteConfirm=!1:e.form.visible=!1,a())),permitted:!0,requireOnline:!0},{name:e.form.data.id===null?t.translate(D):t.translate(w),permitted:!0,requireOnline:i.permitted(l.Auth,!0)&&!e.form.deleteConfirm,submit:!0},{accent:!0,name:t.translate(E),onclick:async()=>n.delete(e.form.data.id).then(async()=>(e.form.visible=!1,m())),permitted:i.permitted(l.Auth,!0)&&e.form.deleteConfirm,requireOnline:!0}],onsubmit:async()=>e.form.data.id===null?(s.data(e.form.data),s.data().authAccountID=n.data().authAccountID,s.data().userAgent=F,s.create().then(async()=>(e.form.visible=!1,m()))):s.update(e.form.data).then(async()=>(e.form.data.id===n.data().id&&n.data(e.form.data),e.form.visible=!1,s.data().key=null,m())),overlay:!0,title:{name:`${e.form.data.id===null?t.translate(D):t.translate(x)} ${t.translate(b)}`}},[r(G,{input:{disabled:e.form.data.id!==null,oninput:a=>{e.form.data.name=a},required:!0,type:"text",value:e.form.data.name},name:t.translate(h),tooltip:t.translate(W)}),r(k,{name:t.translate(S),oninput:a=>{e.form.data.expires=y.fromCivilDate(O.fromString(a)).toString()},required:!0,tooltip:t.translate(P),value:y.fromString(e.form.data.expires).toCivilDate().toJSON()}),r(g,{expand:e.expandPersonal,name:`${t.translate($)} ${t.translate(A)}`,onclick:()=>{e.expandPersonal=!e.expandPersonal}}),e.expandPersonal?r(C,{limit:!0,permissions:e.form.data.permissionsAccount,personal:!0}):[],e.form.data.permissionsHouseholds===null?[]:e.form.data.permissionsHouseholds.map((a,o)=>[r(g,{expand:e.expandHousehold===e.form.data.permissionsHouseholds[o].authHouseholdID,name:`${T.findID(e.form.data.permissionsHouseholds[o].authHouseholdID).name} ${t.translate(A)}`,onclick:()=>{e.expandHousehold=e.expandHousehold===e.form.data.permissionsHouseholds[o].authHouseholdID?"":`${e.form.data.permissionsHouseholds[o].authHouseholdID}`}}),e.expandHousehold===e.form.data.permissionsHouseholds[o].authHouseholdID?r(C,{limit:!0,permissions:e.form.data.permissionsHouseholds[o].permissions}):[]])]):[],r(Y,{actions:[{accent:!0,icon:c.Clear,name:t.translate(B),onclick:async()=>n.deleteAll().then(async()=>i.signOut()),permitted:i.permitted(l.Auth,!0),requireOnline:!0},{name:t.translate(U),onclick:async()=>(d.toggleSessionDebug(),p.enable()),permitted:!d.isSessionDebug(),requireOnline:!0}],data:e.sessions(),editOnclick:a=>{e.form.data=a,e.form.visible=!0},filters:[],loaded:e.loaded,noFilters:!0,sort:e.sort,tableColumns:[{formatter:a=>a.id===n.data().id?`${a.name} (${t.translate(j)})`:a.name,name:t.translate(h),property:"name",type:f.Bold},{name:"ID",property:"id"},{name:t.translate(K),property:"created",type:f.Timestamp},{name:t.translate(S),property:"expires",type:f.Timestamp}],tableColumnsNameEnabled:e.columns,title:{subtitles:s.data().key===null?[]:[{key:"ID",value:`${s.data().id}`},{key:"Key",value:`${s.data().key}`}]}})]}}export{M as SettingsSessions};
