import{Z as _,az as w,S as v,bF as p,A as f,c as l,eD as it,ab as G,bC as c,m as e,eE as I,bL as b,eF as C,ed as L,dj as k,bO as B,al as M,eG as W,x as Y,o as j,bV as O,eH as Z,eI as K,bQ as ct,eJ as ut,ak as dt,eK as pt,bR as mt,I as i,eL as ft,ad as ht,bq as T,br as A,by as h,eM as Dt,aY as gt,i as It,eN as tt,dm as et,ah as y,ai as P,a8 as E,dS as N,ay as U,D as H,dk as _t,ax as V,eO as yt,eP as Pt,C as R,bP as S,eQ as nt,dZ as Tt,am as at,bz as ot,eR as At,eS as bt,eT as jt,eU as lt,aC as vt,cm as kt,b2 as X,eV as u}from"./index-09c2e996.js";import{G as wt}from"./GetHelp-610c77dd.js";const st=_.now();st.addDays(7);const St=st.toCivilDate(),Ct=w.now();let $="";const q={},o={dateToday:_.now(),dateTomorrow:_.now(),dateWeek:_.now(),dates:[],datesOld:[],expandID:null,filter:v(""),project:p.new(),projects:v([]),showComplete:v(!1),tag:v(""),tasks:v([])};function x(a,t,n){let s=t===0&&n===0?document.elementFromPoint(u.state.x,u.state.y):document.elementFromPoint(t,n);if(s!==null&&(s.classList.contains("PlanTasks__item")||s.classList.contains("PlanTasks__list"))&&!s.parentElement.classList.contains("PlanTasks")){const m=document.getElementById(a);s.classList.contains("PlanTasks__item")&&(s=s.parentElement);let d=s.id.split("_")[0],D=s.id.split("_")[1],r=document.getElementById(u.state.target);if(s.id===a){if(u.state.target===""||u.state.target.includes(a)||u.state.target.includes("list")||(s=document.getElementById(u.state.target),s.previousElementSibling===m))return;if(t>s.getBoundingClientRect().x+70){r=s,d=`${u.state.target.split("_")[0]}list`,D=u.state.target.split("_")[1];let g=document.getElementById(`${d}_${D}`);g===null&&(g=document.createElement("ul"),g.classList.add("PlanTasks__list"),g.id=`${d}_${D}`,s.insertAdjacentElement("afterend",g)),s=g}else return}(a.includes("task")||a.includes("project")&&d.includes("project"))&&(a.includes("task")&&d==="project"&&(d=`${d}list`,s=document.getElementById(`${d}_${D}`)),u.setDragTarget(s,"PlanTasks__dragtarget"),a.includes("task")&&d.includes("list")||a.includes("project")&&d==="projectlist"?s.appendChild(m):u.isSourceAfter(n,s)?u.moveSrcAfter(m,s):s.nextElementSibling!==null&&s.nextElementSibling.tagName==="UL"?s.nextElementSibling.insertAdjacentElement("afterend",m):u.moveSrcBefore(m,s)),r!==null&&s!==r&&(r.id.split("_")[0]==="tasklist"&&r.children.length===0?r.remove():r.classList.remove("PlanTasks__dragtarget"))}}async function z(a){const t=E(a);if(u.end("PlanTasks__dragtarget"),u.state.target!==""){const s=u.state.target.split("_")[1];switch(u.state.target.split("_")[0]){case"project":const d=p.findID(s);t.parentID=d.parentID,t.position=I.adjacent(d,p.findAdjacent(d),u.state.before);break;case"projectlist":const D=p.findID(s);t.parentID=D.id,D.children===void 0||D.children.length===0?t.position="0":t.position=I.increase(D.children[D.children.length-1].position,!0);break}}const n=document.getElementById(`project_${a.id}`);return delete t.children,p.update(t).then(async s=>{if(R(s)){u.state.parent!==null&&u.state.parent.insertBefore(n,u.state.parent.children[u.state.position]);return}if(t.parentID===a.parentID?n.classList.remove("PlanTasks__item--dragging"):n.remove(),l.data().collapsedPlanProjects.includes(a.id))return l.collapsePlanProject(a.id);e.redraw()})}async function Q(a){const t=E(a);if(u.end("PlanTasks__dragtarget"),u.state.target!==""){const s=u.state.target.split("_")[1];switch(u.state.target.split("_")[0]){case"project":case"projectlist":const d=c.findPlanProjectID(s);t.parentID=null,t.planProjectID=s,d.length>0?t.position=I.increase(d[d.length-1].position,!0):t.position="0";break;case"task":const D=c.findID(s);t.parentID=D.parentID,t.planProjectID=D.planProjectID,t.position=I.adjacent(D,c.findAdjacent(D),u.state.before);break;case"tasklist":const r=c.findID(s);t.parentID=r.id,t.planProjectID=r.planProjectID,r.children===void 0||r.children.length===0?t.position="0":t.position=I.increase(r.children[r.children.length-1].position,!0);break}}const n=document.getElementById(`task_${a.id}`);return delete t.children,c.update(t).then(async s=>{if(R(s)){u.state.parent!==null&&u.state.parent.insertBefore(n,u.state.parent.children[u.state.position]);return}if(t.parentID!==a.parentID||t.planProjectID!==a.planProjectID?n.remove():n.classList.remove("PlanTasks__item--dragging"),l.data().collapsedPlanTasks.includes(a.id))return l.collapsePlanTask(a.id);e.redraw()})}async function F(a,t){let n="";if(t===null?n=`project_${a}`:n=`task_${t}`,u.start(document.getElementById(n),"PlanTasks__item--dragging"),a!==null&&!l.data().collapsedPlanProjects.includes(a))return l.collapsePlanProject(a);if(t!==null&&!l.data().collapsedPlanProjects.includes(t))return l.collapsePlanTask(t)}function J(){return{view:a=>a.attrs.items.length===0&&a.attrs.noHeaders===!0&&a.attrs.tasks.length===0?e("div.PlanTasks__none",[e(h,{icon:i.NotFound}),e("span",l.translate(Dt)),f.data.layoutAppToolbarActionButtons.map(t=>t.permitted&&f.isSessionOnline()||!t.requireOnline?e(gt,{icon:i.Add,name:`${l.translate(It)} ${t.name}`,onclick:async()=>{switch(t.name){case l.translate(et):f.setLayoutAppForm(L,{...k.new(),authAccountID:a.attrs.authAccountID,authHouseholdID:a.attrs.authHouseholdID,planProjectID:a.attrs.id});break;case l.translate(tt):f.setLayoutAppForm(C,{...p.new(),authAccountID:a.attrs.authAccountID,authHouseholdID:a.attrs.authHouseholdID,parentID:a.attrs.id});break;default:f.setLayoutAppForm(b,{...c.new(),authAccountID:a.attrs.authAccountID,authHouseholdID:a.attrs.authHouseholdID,planProjectID:a.attrs.id})}},permitted:!0,primary:!0,requireOnline:!0}):null)]):[a.attrs.items.map(t=>e("li",{id:`item_${t.id}`,key:`item_${t.id}`},[e("div.PlanTasks__item.PlanTasks__item--item.PlanTasks__item--info",{onclick:()=>{f.setLayoutAppForm(L,t)}},[e(h,{classes:"PlanTasks__button PlanTasks__button--drag PlanTask__button--hidden",icon:i.Drag,style:{visibility:"hidden"}}),y.permitted(P.Shop,!0,t.authHouseholdID)?e(h,{classes:"PlanTasks__button PlanTasks__button--checkbox",icon:t.inCart?i.ShopItemInCart:i.ShopItemToGet,onclick:async n=>{n.stopPropagation();const s=E(t);return s.inCart=!s.inCart,k.update(s)},style:{color:"var(--color_primary)"}}):[],e("div.PlanTasks__name",{style:{cursor:f.isSessionOnline()?void 0:"default"}},[e(N,{value:t.name}),e("div.PlanTasks__details",[t.price===0?[]:e("span.ButtonArray__item.ButtonArray__item--small",[e("span",U.toString(t.price,H.findID(l.data().primaryAuthHouseholdID).preferences.currency))]),t.shopCategoryID===null?[]:e("span.ButtonArray__item.ButtonArray__item--small",[e(h,{icon:i.ShopCategory}),e("span",_t.findID(t.shopCategoryID).name)]),t.budgetPayeeID===null?[]:e(e.route.Link,{class:"ButtonArray__item ButtonArray__item--small",href:`/shop/items?store=${V.findID(t.budgetPayeeID).id}`,onclick:n=>{n.stopPropagation()},options:{state:{key:Date.now()}}},[e(h,{icon:i.BudgetPayee}),e("span",V.findID(t.budgetPayeeID).name)]),e("span.ButtonArray__item.ButtonArray__item--small",[e(h,{icon:i.ShopList}),e("span",t.shopListID===null?l.translate(yt):Pt.findID(t.shopListID).name)])])])])])),a.attrs.tasks.map(t=>!o.showComplete()&&t.done||o.showComplete()&&!t.done&&c.getChildrenDone(t)===0?e("div",{key:`task_${t.id}`},[]):e(`li.${T.class(A.Fade)}`,{id:`task_${t.id}`,key:`task_${t.id}`,onbeforeremove:T.onbeforeremove(A.Fade)},[e("div.PlanTasks__item.PlanTasks__item--task",{onclick:()=>{t.authAccountID===null&&t.authHouseholdID===null&&!f.isSessionAdmin()||f.setLayoutAppForm(b,t)}},[e("div.PlanTasks__item--info",[f.isSessionOnline()&&o.dates.length===0&&(t.authAccountID!==null||t.authHouseholdID!==null||j.data().admin===!0)?e(h,{classes:"PlanTasks__button PlanTasks__button--drag",draggable:!0,icon:i.Drag,ondrag:n=>{n.redraw=!1,x(`task_${t.id}`,n.clientX,n.clientY)},ondragend:async()=>Q(t),ondragstart:async n=>(n.dataTransfer.setDragImage(n.target.parentElement.parentElement,0,0),F(null,t.id)),ontouchend:async()=>Q(t),ontouchmove:async n=>{n.redraw=!1,n.preventDefault();const s=n.changedTouches[0];x(`task_${t.id}`,s.clientX,s.clientY)},ontouchstart:async()=>F(null,t.id)}):[],y.permitted(P.Plan,!0,t.authHouseholdID)?e(h,{classes:"PlanTasks__button PlanTasks__button--checkbox",icon:t.done?i.CheckYes:i.CheckNo,onclick:async n=>(n.stopPropagation(),c.updateDone(t).then(async s=>{R(s)||!t.done&&t.recurrence===null&&(n.target.textContent="check_box")})),style:{color:`var(--color_${S.getValue(t.color)==="Default"?"black":S.getValue(t.color).toLowerCase()})`,display:t.template?"none":void 0}}):[],e("div.PlanTasks__name",{class:t.done?"PlanTasks__name--done":void 0,style:{cursor:f.isSessionOnline()?void 0:"default"}},[e(N,{value:t.name}),e("div.PlanTasks__details",[o.dates.length!==0||o.projects===null?e(e.route.Link,{class:"ButtonArray__item ButtonArray__item--small",href:`/plan/tasks?project=${t.planProjectID}`,onclick:n=>{n.stopPropagation()},options:{state:{key:Date.now()}}},[e(h,{icon:i.PlanProject,style:{color:`var(--color_${S.values[p.findID(t.planProjectID).color].toLowerCase()})`}}),e("span",t.planProjectID===null?t.authHouseholdID===null?l.translate(M):l.translate(Y):p.findID(t.planProjectID).name)]):[],t.dueDate===null?[]:e(e.route.Link,{class:"ButtonArray__item ButtonArray__item--small",href:`/plan/tasks?date=${_.fromString(t.dueDate).toCivilDate().toJSON()}`,options:{state:{key:Date.now()}}},[e(h,{icon:i.Calendar,style:{color:t.dueDate<o.dateToday.toString()?"var(--color_negative)":"var(--color_positive)"}}),e("span",_.fromString(t.dueDate).toDueDate(l.data().preferences.formatTime24)),t.notify?e(h,{classes:"PlanTasks__notification",icon:i.Notification}):[],t.recurrence===null?[]:e(h,{classes:"PlanTasks__recurrence",icon:i.Recurring})]),t.duration>0?e("span.ButtonArray__item.ButtonArray__item--small",[e(h,{icon:i.CookMealTime}),e("span",nt.toString(t.duration))]):[],t.authHouseholdID!==null&&t.authAccountID!==null?e("span.ButtonArray__item.ButtonArray__item--small",[e(h,{icon:i.Personal,style:{color:S.toString(H.findMember(t.authAccountID).color)}}),e("span",H.findMemberName(t.authAccountID))]):[],t.inventoryItemID===null?[]:e(e.route.Link,{class:"ButtonArray__item ButtonArray__item--small",href:`/inventory/all?id=${t.inventoryItemID}`},[e(h,{icon:i.Inventory}),e("span",Tt.findID(t.inventoryItemID).name)]),e(at,{icon:i.Tag,name:"tags",small:!0,value:t.tags,valueLinkPrefix:"/plan/tasks?tag="})])]),e("div.PlanTasks__actions",[t.details!==void 0&&t.details!==""?e(h,{classes:"PlanTasks__arrow",icon:o.expandID===t.id?i.UnfoldMore:i.UnfoldLess,id:`taskshowdetails_${t.id}`,onclick:async n=>{n.stopPropagation(),o.expandID===t.id?o.expandID=null:o.expandID=t.id}}):[],f.isSessionOnline()&&y.permitted(P.Plan,!0,t.authHouseholdID)?e("div.PlanTasks__menu-container",[e(h,{classes:"GlobalButtonIconAdd PlanTasks__arrow",icon:i.Add,id:`taskmenutoggle_${t.id}`,onclick:async n=>{n.stopPropagation(),f.setComponentsDropdownMenu(`taskmenu_${t.id}`,n.clientY)}}),e(ot,{id:`taskmenu_${t.id}`,items:[{icon:i.Before,name:l.translate(At),onclick:()=>{const n=c.new();n.authAccountID=t.authAccountID,n.authHouseholdID=t.authHouseholdID,n.parentID=t.parentID,n.planProjectID=t.planProjectID,n.position=I.adjacent(t,c.findAdjacent(t),!0),f.setLayoutAppForm(b,n)},permitted:t.authAccountID!==null||t.authHouseholdID!==null||j.data().admin===!0,requireOnline:!0},{icon:i.After,name:l.translate(bt),onclick:()=>{const n=c.new();n.authAccountID=t.authAccountID,n.authHouseholdID=t.authHouseholdID,n.parentID=t.parentID,n.planProjectID=t.planProjectID,n.position=I.adjacent(t,c.findAdjacent(t),!1),f.setLayoutAppForm(b,n)},permitted:t.authAccountID!==null||t.authHouseholdID!==null||j.data().admin===!0,requireOnline:!0},{icon:i.Sub,name:l.translate(jt),onclick:()=>{const n=c.new();n.authAccountID=t.authAccountID,n.authHouseholdID=t.authHouseholdID,n.color=t.color,n.parentID=t.id,t.children!==void 0&&t.children.length>0&&(n.position=I.increase(t.children[t.children.length-1].position,!0)),n.planProjectID=t.planProjectID,f.setLayoutAppForm(b,n)},permitted:t.authAccountID!==null||t.authHouseholdID!==null||j.data().admin===!0,requireOnline:!0},{icon:i.Template,name:l.translate(lt),onclick:()=>{const n=E(t);n.id=null,n.authAccountID=l.data().id,n.authHouseholdID=l.data().primaryAuthHouseholdID,n.template=!1,f.setLayoutAppForm(b,n)},permitted:!0,requireOnline:!0}]})]):[],e(`i.PlanTasks__arrow.GlobalButtonIconExpand${l.data().collapsedPlanTasks.includes(`${t.id}`)?"":".GlobalButtonIconExpand--active"}`,{id:`taskexpand_${t.id}`,onclick:async n=>(n.stopPropagation(),l.collapsePlanTask(t.id)),style:{visibility:t.children===void 0||t.children!==void 0&&t.children.length===0||!o.showComplete()&&c.getChildrenDone(t)===2||o.showComplete()&&c.getChildrenDone(t)===0?"hidden":void 0}},i.Expand)])]),o.expandID===t.id?e(`div.PlanTasks__item--details.${T.class(A.Expand)}`,{id:`taskdetails_${t.id}`,onbeforeremove:T.onbeforeremove(A.Expand),onclick:n=>{n.stopPropagation()}},e(N,{value:t.details})):[]]),t.children!==void 0&&t.children.length===0||!o.showComplete()&&c.getChildrenDone(t)===2||o.showComplete()&&c.getChildrenDone(t)===0||l.data().collapsedPlanTasks.includes(`${t.id}`)?[]:e(`ul.PlanTasks__list.${T.class(A.Expand)}`,{id:`tasklist_${t.id}`,onbeforeremove:T.onbeforeremove(A.Expand)},e(J,{authAccountID:t.authAccountID,authHouseholdID:t.authHouseholdID,id:t.planProjectID,items:[],tasks:t.children===void 0?[]:t.children}))]))]}}function rt(){return{view:a=>a.attrs.headers!==void 0&&a.attrs.headers.length>0?a.attrs.headers.map(t=>{const n=vt.findID(typeof t=="string"?"":t.budgetCategoryID),s=typeof t=="string"?[]:k.findPlanProjectID(t.id),m=typeof t=="string"?t===l.translate(Z)?o.showComplete()?[]:c.dueDatePast():c.findDueDate(t===l.translate(O)||t===l.translate(K)?t===l.translate(O)?o.dateToday.toCivilDate().toJSON():o.dateTomorrow.toCivilDate().toJSON():t):t.created===null?c.findTemplates(t.templateType):c.findPlanProjectID(t.id),d=k.costItems(s),D=c.getDuration(m);return e("li",{id:typeof t=="string"?`date_${t}`:`project_${t.id}`,key:typeof t=="string"?`date_${t}`:`project_${t.id}`},[e("div.PlanTasks__item.PlanTasks__item--header",{onclick:()=>{typeof t!="string"&&f.isSessionOnline()&&f.setLayoutAppForm(C,t)}},[typeof t!="string"&&t.created!==null&&f.isSessionOnline()?e(h,{classes:"PlanTasks__button PlanTasks__button--drag",draggable:!0,icon:i.Drag,ondrag:r=>{r.redraw=!1,x(`project_${t.id}`,r.clientX,r.clientY)},ondragend:async()=>z(t),ondragstart:async r=>(r.dataTransfer.setDragImage(r.target.parentElement.parentElement,0,0),F(t.id,null)),ontouchend:async()=>z(t),ontouchmove:async r=>{r.redraw=!1,r.preventDefault();const g=r.changedTouches[0];x(`project_${t.id}`,g.clientX,g.clientY)},ontouchstart:async()=>F(t.id,null)}):[],typeof t=="string"?[]:e(h,{classes:"PlanTasks__label",icon:t.icon===""?i.PlanProject:t.icon,style:{color:`var(--color_${t.color===B.Default?"content":S.values[t.color].toLowerCase()})`}}),e("div.PlanTasks__name",[typeof t=="string"||t.created===null?e("span.PlanTasks__name.PlanTasks__name--header",[typeof t=="string"?t==="Tomorrow"||t==="Today"||t==="Overdue"?t:w.fromString(t)<=St&&w.fromString(t)>=Ct?_.fromCivilDate(w.fromString(t)).toDay():w.fromString(t).toString(l.data().preferences.formatDateOrder,l.data().preferences.formatDateSeparator):t.name]):e(e.route.Link,{class:"PlanTasks__name PlanTasks__name--header",href:`/plan/tasks?project=${t.id}`,onclick:r=>{r.stopPropagation()},options:{state:{key:Date.now()}}},[t.name,p.findCount(t)>0?e("span.GlobalCount",p.findCount(t)):[]]),e("div.PlanTasks__details",[typeof t=="string"||t.budgetCategoryID===null?[]:e("span.ButtonArray__item.ButtonArray__item--small",[e(h,{icon:i.BudgetCategory}),e("span",n.name),e("span",{style:{color:n.budgetMonthCategoryAmount+n.budgetTransactionAmount>=d?"var(--color_positive)":"var(--color_negative)",filter:"none","padding-left":"5px"}},`${U.toString(n.budgetMonthCategoryAmount+n.budgetTransactionAmount,H.findID(n.authHouseholdID).preferences.currency)}/${U.toString(d,H.findID(n.authHouseholdID).preferences.currency)}`)]),D>0?e("span.ButtonArray__item.ButtonArray__item--small",[e(h,{icon:i.CookMealTime}),e("span",nt.toString(D))]):[],typeof t=="string"?[]:e(at,{icon:i.Tag,name:"tags",small:!0,value:t.tags,valueLinkPrefix:"/plan/tasks?tag="})])]),e("div.PlanTasks__actions",[typeof t=="string"||t.id==="homechart"&&j.data().admin!==!0?[]:e("div.PlanTasks__menu-container",[e(h,{classes:"PlanTasks__arrow GlobalButtonIconAdd",icon:i.Add,id:`headermenutoggle_${t.id}`,onclick:async r=>{r.stopPropagation(),f.setComponentsDropdownMenu(`headermenu_${t.id}`,r.clientY)}}),e(ot,{id:`headermenu_${t.id}`,items:[{icon:i.PlanTask,name:l.translate(kt),onclick:()=>{const r=c.new(),g=c.findPlanProjectID(t.id);if(t.id==="homechart"||t.id==="household"||t.id==="personal")switch(r.template=!0,t.id){case"homechart":r.authAccountID=null,r.authHouseholdID=null;break;case"household":r.authAccountID=null,r.authHouseholdID=t.authHouseholdID;break;case"personal":r.authAccountID=t.authAccountID,r.authHouseholdID=null}else r.authAccountID=t.authAccountID,r.authHouseholdID=t.authHouseholdID,r.dueDate=o.dateTomorrow.toString(),r.planProjectID=t.id;g.length>0?r.position=I.increase(g[g.length-1].position,!0):r.position="0",f.setLayoutAppForm(b,r)},permitted:t.authAccountID!==null&&y.permitted(P.Plan,!0)||t.authHouseholdID!==null&&y.permitted(P.Plan,!0)||j.data().admin===!0,requireOnline:!0},{icon:i.PlanProject,name:l.translate(tt),onclick:()=>{const r=p.new();r.authAccountID=t.authAccountID,r.authHouseholdID=t.authHouseholdID,r.color=t.color;const g=p.findChildren(t.id);g.length>0?r.position=I.increase(g[g.length-1].position,!0):r.position="0",r.parentID=t.id,f.setLayoutAppForm(C,r)},permitted:t.authAccountID!==null&&y.permitted(P.Plan,!0)||t.authHouseholdID!==null&&y.permitted(P.Plan,!0)||j.data().admin===!0,requireOnline:!0},{icon:i.ShopItem,name:l.translate(et),onclick:()=>{f.setLayoutAppForm(L,{...k.new(),planProjectID:t.id})},permitted:y.permitted(P.Shop,!0)&&t.id!=="household"&&t.id!=="personal",requireOnline:!0},{icon:i.Template,name:l.translate(lt),onclick:()=>{f.setLayoutAppForm(C,{...t,id:null,planProjectID:t.id,position:I.increase(t.position,!1)})},permitted:t.authAccountID!==null&&y.permitted(P.Plan,!0)||t.authHouseholdID!==null&&y.permitted(P.Plan,!0),requireOnline:!0}]})]),typeof t=="string"?[]:e(`i.PlanTasks__arrow.GlobalButtonIconExpand${l.data().collapsedPlanProjects.includes(`${t.id}`)?"":".GlobalButtonIconExpand--active"}`,{id:`headerexpand_${t.id}`,onclick:async r=>(r.stopPropagation(),l.collapsePlanProject(t.id)),style:{visibility:t.children!==void 0&&t.children.length===0&&c.findPlanProjectID(t.id).filter(r=>r.done===o.showComplete()).length===0?"hidden":void 0}},i.Expand)])]),typeof t!="string"&&l.data().collapsedPlanProjects.includes(`${t.id}`)?[]:e(`ul.PlanTasks__list.PlanTasks__list--header.${T.class(A.Expand)}`,{id:typeof t=="string"?`datelist_${t}`:`projectlist_${t.id}`,onbeforeremove:T.onbeforeremove(A.Expand)},[e(J,{authAccountID:typeof t=="string"?null:t.authAccountID,authHouseholdID:typeof t=="string"?null:t.authHouseholdID,id:typeof t=="string"?null:t.id,items:s,noHeaders:typeof t!="string"&&t.children!==void 0&&t.children.length===0,tasks:m}),typeof t=="string"?[]:e(rt,{headers:t.children})])])}):[]}}function Bt(){return{oninit:async()=>{switch(X.spanStart("PlanTasks"),o.filter("all"),o.project=p.new(),o.showComplete(!1),o.tag(""),f.setLayoutApp({...wt("plan"),breadcrumbs:[{name:l.translate(it)}],toolbarActionButtons:[{...G().newPlanTask,onclick:()=>{const a=c.new();let t=[];const n=e.route.param().filter,s=e.route.param().project;if(n==="household")a.authAccountID=null,a.authHouseholdID=l.data().primaryAuthHouseholdID,t=c.personal();else if(s!==void 0){const m=p.findID(s);a.authAccountID=m.authAccountID,a.authHouseholdID=m.authHouseholdID,a.planProjectID=s,t=c.findPlanProjectID(m.id)}else a.authAccountID=l.data().id,a.authHouseholdID=null,t=c.personal();t.length>0?a.position=I.increase(t[t.length-1].position,!0):a.position="0",f.setLayoutAppForm(b,a)}},{...G().newPlanProject,onclick:()=>{const a=p.new();let t=[];const n=e.route.param().filter,s=e.route.param().project;if(n==="household")a.authAccountID=null,a.authHouseholdID=l.data().primaryAuthHouseholdID,t=p.household();else if(s!==void 0){const m=p.findID(s);a.authAccountID=m.authAccountID,a.authHouseholdID=m.authHouseholdID,a.color=m.color,a.parentID=m.id,t=p.findChildren(m.id)}else a.authAccountID=l.data().id,a.authHouseholdID=null,t=p.personal();t.length>0?a.position=I.increase(t[t.length-1].position,!0):a.position="0",f.setLayoutAppForm(C,a)}},{...G().newShopItem,onclick:()=>{f.setLayoutAppForm(L,{...k.new(),planProjectID:e.route.param().project})}}]}),o.dates=[],o.dateToday=_.midnight(),o.dateTomorrow=_.midnight(),o.dateTomorrow.addDays(1),o.dateWeek=_.midnight(),o.dateWeek.addDays(6),o.projects=v.lift((a,t,n,s)=>{if(e.route.param().project!==void 0)return o.project=p.findID(e.route.param().project),o.project.children=p.findChildren(o.project.id),[];let m=a;if(s==="")m=p.nested();else return p.findTag(s);return n==="templates"?[{...p.new(),authAccountID:l.data().id,color:l.data().preferences.colorPrimary===0?B.Teal:l.data().preferences.colorPrimary,id:"personal",name:l.translate(M),templateType:W.Account},{...p.new(),authHouseholdID:l.data().primaryAuthHouseholdID,color:l.data().preferences.colorPrimary===0?B.Indigo:l.data().preferences.colorSecondary,id:"household",name:l.translate(Y),templateType:W.Household},{...p.new(),authAccountID:j.data().admin===!0?null:l.data().id,color:l.data().preferences.colorPrimary===0?B.Pink:l.data().preferences.colorAccent,id:"homechart",name:"Homechart",templateType:W.Homechart}]:(m=m.filter(d=>{switch(n){case"household":if(d.authHouseholdID===null)return!1;break;case"personal":if(d.authAccountID===null)return!1;break;case"today":case"upcoming":return!1}return!(s!==""&&!d.tags.includes(s))}),e.redraw(),m)},p.data,p.nested,o.filter,o.tag),o.tasks=v.lift((a,t,n,s)=>{if(n==="templates"||e.route.param().project!==void 0||e.route.param().date!==void 0)return[];let m=a;if(s==="")m=c.nested();else return c.findTag(s);return m=m.filter(d=>{if(d.planProjectID!==null||d.template)return!1;switch(n){case"household":if(d.authHouseholdID===null)return!1;break;case"personal":if(d.authAccountID===null)return!1;break;case"today":case"upcoming":return!1}return!(s!==""&&!d.tags.includes(s))}),e.redraw(),m},c.data,c.nested,o.filter,o.tag),e.route.param().filter!==void 0&&o.filter(e.route.param().filter),e.route.param().project!==void 0&&l.data().collapsedPlanProjects.includes(e.route.param().project)&&await l.collapsePlanProject(e.route.param().project),e.route.param().tag!==void 0&&(o.tag(e.route.param().tag),o.filter(o.tag())),o.filter()){case"upcoming":o.dates.push(l.translate(K));for(let a=2;a<7;a++){const t=_.fromString(o.dateToday.toString());t.addDays(a),o.dates.push(t.toCivilDate().toJSON())}case"today":o.dates.unshift(l.translate(O)),o.dates.unshift(l.translate(Z))}e.route.param().date!==void 0&&(o.filter(""),o.dates=[e.route.param().date]),X.spanEnd("PlanTasks")},onremove:()=>{o.projects.end(!0),o.tasks.end(!0)},view:()=>{const a=p.isLoaded()&&c.isLoaded()&&k.isLoaded();return[e("div.PlanTasks",{oncreate:t=>{$=e.route.get(),q[$]!==void 0&&(t.dom.scrollTop=q[$])},onremove:t=>{q[$]=t.dom.scrollTop}},[e(ct,{loaded:a,tabs:[{active:e.route.param().filter==="today",count:c.getCountToday(),href:"/plan/tasks?filter=today",name:l.translate(O)},{active:e.route.param().filter==="upcoming",count:c.getCountUpcoming(),href:"/plan/tasks?filter=upcoming",name:l.translate(ut)},{active:e.route.param().filter===void 0&&e.route.param().project===void 0&&e.route.param().date===void 0,count:c.data().length,href:"/plan/tasks",name:l.translate(dt)},{active:e.route.param().filter==="templates",count:c.templates().length,href:"/plan/tasks?filter=templates",name:l.translate(pt)},{active:e.route.param().filter==="personal",count:c.getCountPersonal(),href:"/plan/tasks?filter=personal",name:l.translate(M)},{active:e.route.param().filter==="household",count:c.getCountHousehold(),href:"/plan/tasks?filter=household",name:l.translate(Y)},...e.route.param().project!==void 0&&o.project.parentID!==null?[{active:!1,href:`/plan/tasks?project=${o.project.parentID}`,name:p.findID(o.project.parentID).name}]:[],...e.route.param().project===void 0?[]:[{active:!0,href:e.route.get(),name:o.project.name}]]}),a?e(mt,{actions:o.filter()==="today"||o.filter()==="upcoming"?[]:[{icon:i.Show,name:l.translate(ft),onclick:async()=>new Promise(t=>(o.showComplete(!o.showComplete()),t())),permitted:!0,requireOnline:!1,secondary:o.showComplete()}],filters:o.filter()==="today"||o.filter()==="upcoming"?[]:[{icon:i.Tag,name:l.translate(ht),onclick:t=>{o.tag()===t?o.tag(""):o.tag(t)},selected:()=>[o.tag()],value:p.allTagNames()}]}):[],e("ul.PlanTasks__list",a?[e(J,{authAccountID:o.filter()==="personal"?l.data().id:null,authHouseholdID:o.filter()==="personal"?null:l.data().primaryAuthHouseholdID,id:null,items:[],tasks:o.tasks()}),e(rt,{headers:o.dates.length>0?o.dates:o.project.id===null?o.projects===null?[]:o.projects():[o.project]})]:[...Array(5)].map(()=>e(`div.PlanTasks__item.PlanTasks__item--loading.${T.class(A.Pulse)}`,[e("span"),e("span")])))])]}}}export{Bt as PlanTasks};
