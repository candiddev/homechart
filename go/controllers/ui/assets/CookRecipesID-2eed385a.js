import{bB as D,ct as n,S as m,a8 as $,C as I,m as t,c as o,cI as M,az as R,cJ as _,A as d,cK as x,o as E,ai as r,cL as U,cM as q,cA as V,F as l,af as H,cf as j,ce as B,cN as C,cO as J,cP as Q,cQ as K,cR as Y,I as c,cS as Z,cT as z,cU as X,cV as ee,Z as S,cW as oe,cX as b,cD as v,cY as W,cE as h,cZ as w,cB as te,c_ as ie,k as ae,c$ as y,d0 as ce,d1 as ne,co as g,d2 as G,bI as le,d3 as se,d4 as re,d5 as pe,cG as de,d6 as ue,cF as ke,c5 as A,ca as me,d7 as Re,aY as be,s as ge,ah as p,bQ as fe,r as L,q as P,d8 as T,d9 as O,aQ as De,da as Ie,db as Ce,dc as Se,b as ve,cu as We,i as he,dd as we,ab as F,bK as ye,de as Ge,cv as Ae,b2 as N}from"./index-09c2e996.js";import{F as Le}from"./FormImportRecipe-035ef431.js";import{F as Pe}from"./FormShopItemIngredients-5475d1d1.js";import{G as Te}from"./GetHelp-610c77dd.js";import"./Filter-01c23926.js";function _e(){const e={cookMealPlan:D.new(),cookRecipe:n.new(),edit:m(!1),editLog:null,formVisible:0,id:m(""),lift:m(),loaded:!1,scale:"1"};function f(){d.setLayoutApp({...Te("cook"),breadcrumbs:[{link:d.isSessionAuthenticated()?"/cook/recipes":"/signin",name:o.translate(g)},{link:d.isSessionAuthenticated()?"/cook/recipes":"/signin",name:o.translate(We)},...e.loaded?[{name:e.cookRecipe.name===""?o.translate(he):e.cookRecipe.name}]:[]],toolbarActionButtons:[{icon:c.ShopItem,name:o.translate(we),onclick:()=>{e.formVisible=2},permitted:p.permitted(r.Shop,!0),requireOnline:!0},{...F().newCookMealPlan,onclick:()=>{d.setLayoutAppForm(ye,{...D.new(),cookRecipeID:e.cookRecipe.id})}},F().newCookRecipe,{icon:c.Template,name:o.translate(Ge),onclick:async()=>new Promise(i=>(e.edit(!0),t.route.set(`/cook/recipes/${e.cookRecipe.id}?copy&edit`,{},{state:{key:Date.now()}}),i())),permitted:p.permitted(r.Cook,!0)&&t.route.param().id!=="new",requireOnline:!0},{icon:c.ImportExport,name:o.translate(Ae),onclick:()=>{e.formVisible=1},permitted:p.permitted(r.Cook,!0,e.cookRecipe.authHouseholdID),requireOnline:!0}]})}return{oninit:()=>{e.lift=m.lift(async(a,s,u)=>{(e.cookRecipe.id===null||!s)&&(e.cookRecipe=$(n.findID(u)),e.cookRecipe.id===null&&u!==""?await n.read(u,void 0,!0).then(async k=>{if(k!==void 0&&!I(k)){n.set(k),e.cookRecipe=k,e.loaded=!0;return}}):(e.cookMealPlan={...e.cookMealPlan,cookRecipeID:e.cookRecipe.id,cookRecipeScale:e.scale},t.route.param().copy!==void 0&&(e.cookRecipe.id=null),e.loaded=!0),t.redraw()),f()},n.data,e.edit,e.id),e.loaded=!1,N.spanStart("CookRecipesID"),t.route.param().edit!==void 0&&e.edit(!0),t.route.param().scale!==void 0&&t.route.param().scale!=="0"&&(e.scale=t.route.param().scale);const i=t.route.param().id;i==="new"?(e.cookRecipe=n.new(),e.cookRecipe.name=o.translate(M),e.cookRecipe.tags=[],e.cookRecipe.timeCook=15,e.cookRecipe.timePrep=15,e.cookRecipe.notes=[{complexity:0,date:R.now().toJSON(),note:o.translate(_),rating:0}],e.editLog=e.cookRecipe.notes[0].date,f()):e.id(i),N.spanEnd("CookRecipesID")},onremove:()=>{e.lift.end(!0)},view:()=>[d.isSessionAuthenticated()&&x.isPermitted(E.data().permissionsHouseholds,r.Cook,U.View,e.cookRecipe.authHouseholdID)?[t(Le,{toggle:i=>{e.formVisible=i?1:0},visible:e.formVisible===1}),t(Pe,{cookMealPlans:[e.cookMealPlan],toggle:i=>{e.formVisible=i?2:0},visible:e.formVisible===2})]:[],t(ve,{classes:["CookRecipesID__form"],lastModified:e.cookRecipe.updated,loaded:e.loaded,title:{buttonLeft:{icon:e.edit()?c.Cancel:e.cookRecipe.deleted===null?c.Delete:c.DeleteForever,name:e.edit()?o.translate(L):e.cookRecipe.deleted===null?o.translate(P):o.translate(Ce),onclick:async()=>{if(e.edit()){e.edit(!1),t.route.param().id==="new"?t.route.set("/cook/recipes"):t.route.set(`/cook/recipes/${t.route.param().id}`);return}else if(e.cookRecipe.deleted===null){const i=n.findID(t.route.param().id);return i.deleted=S.now().toString(),n.update(i).then(()=>{t.route.set("/cook/recipes")})}return n.delete(t.route.param().id).then(()=>{t.route.set("/cook/recipes")})},permitted:p.permitted(r.Cook,!0,e.cookRecipe.authHouseholdID),requireOnline:!0},buttonRight:{icon:e.cookRecipe.deleted===null?e.edit()?c.Save:c.Edit:c.Restore,name:e.cookRecipe.deleted===null?e.edit()?o.translate(T):o.translate(O):o.translate(Se),onclick:async()=>{if(e.cookRecipe.deleted!==null)return e.cookRecipe.deleted=null,n.update(e.cookRecipe).then(()=>{e.cookRecipe=n.findID(e.cookRecipe.id)});if(e.edit())return e.cookRecipe.id===null?n.create(e.cookRecipe).then(i=>{if(I(i))return i;t.route.set(`/cook/recipes/${i.id}`,{},{state:{key:Date.now()}})}):n.update(e.cookRecipe).then(()=>{t.route.set(`/cook/recipes/${t.route.param().id}`,{},{state:{key:Date.now()}})});e.edit(!0),t.route.set(`/cook/recipes/${e.cookRecipe.id}?edit`,{},{state:{key:Date.now()}})},permitted:e.cookRecipe.id===null||p.permitted(r.Cook,!0,e.cookRecipe.authHouseholdID),requireOnline:!0},name:e.loaded?e.cookRecipe.name:""},wrap:!0},[t(q,{disabled:!e.edit(),name:o.translate(V),oninput:i=>{e.cookRecipe.image=i},value:e.cookRecipe.image}),t("div.CookRecipesID__heading",[e.edit()?t(l,{input:{oninput:i=>{e.cookRecipe.name=i},type:"text",value:e.cookRecipe.name},name:o.translate(H),tooltip:o.translate(j)}):[],e.edit()?t(B,{item:e.cookRecipe,permissionComponent:r.Cook}):[],t(C,{disabled:!e.edit(),getDuration:()=>e.cookRecipe.timePrep,name:o.translate(J),setDuration:i=>{e.cookRecipe.timePrep=i},tooltip:o.translate(Q)}),t(C,{disabled:!e.edit(),getDuration:()=>e.cookRecipe.timeCook,name:o.translate(K),setDuration:i=>{e.cookRecipe.timeCook=i},tooltip:o.translate(Y)}),t(l,{input:{datalist:n.tagNames(),disabled:!e.edit(),icon:c.Tag,type:"text",value:e.cookRecipe.tags,valueLinkPrefix:"/cook/recipes?tag="},name:o.translate(Z),tooltip:o.translate(z)}),t(l,{input:{disabled:!e.edit(),oninput:i=>{e.cookRecipe.source=i},type:"text",value:e.cookRecipe.source},name:o.translate(X),tooltip:o.translate(ee)}),e.cookRecipe.deleted===null?[]:t(l,{input:{disabled:!0,oninput:()=>{},type:"text",value:S.fromString(e.cookRecipe.deleted).toCivilDate().toString(o.data().preferences.formatDateOrder,o.data().preferences.formatDateSeparator)},name:o.translate(oe),tooltip:""})]),e.edit()?[]:t(b,{disabled:!0,iconSelect:c.RatingSelect,iconUnselect:c.RatingUnselect,max:5,name:o.translate(v),tooltip:o.translate(W),value:e.cookRecipe.complexity}),e.edit()?[]:t(b,{disabled:!0,iconSelect:c.RatingSelect,iconUnselect:c.RatingUnselect,max:5,name:o.translate(h),tooltip:o.translate(w),value:e.cookRecipe.rating}),t(l,{input:{disabled:!e.edit(),oninput:i=>{e.cookRecipe.servings=i},type:"text",value:n.scaleIngredient(e.cookRecipe.servings,e.scale)},name:o.translate(te),tooltip:o.translate(ie)}),e.edit()?t(ae,{name:o.translate(y),onclick:()=>{e.cookRecipe.public=!e.cookRecipe.public},value:e.cookRecipe.public}):t(l,{input:{oninput:i=>{e.scale=i},onremove:()=>{e.scale="1",t.redraw()},type:"text",value:e.scale},name:o.translate(ce),tooltip:o.translate(ne)}),t(l,{autocompleteOptions:[`${o.translate(g)} > ${G}`],name:o.translate(le),textArea:{clickable:!0,disabled:!e.edit(),oninput:i=>{e.cookRecipe.ingredients=i},value:e.edit()?e.cookRecipe.ingredients:n.scaleIngredients(e.cookRecipe.ingredients,e.scale)},tooltip:o.translate(se)}),t(l,{autocompleteOptions:[`${o.translate(g)} > ${G}`],name:o.translate(re),textArea:{clickable:!0,disabled:!e.edit(),oninput:i=>{e.cookRecipe.directions=i},value:e.cookRecipe.directions},tooltip:o.translate(pe)}),!e.edit()&&d.isSessionAuthenticated()?[t(l,{input:{disabled:!0,oninput:()=>{},type:"text",value:e.cookRecipe.cookMealPlanCount},name:o.translate(de),tooltip:""}),t(l,{input:{disabled:!0,oninput:()=>{},type:"text",value:e.cookRecipe.cookMealPlanLast===null?o.translate(ue):R.fromString(e.cookRecipe.cookMealPlanLast).toString(o.data().preferences.formatDateOrder,o.data().preferences.formatDateSeparator)},name:o.translate(ke),tooltip:""})]:[],e.cookRecipe.public?t(l,{input:{disabled:!0,markdown:!0,oninput:()=>{},type:"text",value:`${A().hostname===""?window.location.origin:A().hostname}${window.location.pathname}`},name:`${o.translate(y)} ${o.translate(me)}`,tooltip:""}):[],t("div.CookRecipesID__notes#notes",[t("div",[t("p",o.translate(Re)),t(be,{icon:c.Add,name:o.translate(ge),onclick:async()=>new Promise(i=>{const a=R.now(),s=e.cookRecipe.notes.findIndex(u=>u.date===a.toJSON());return s<0?(e.cookRecipe.notes.unshift({...n.newLog(),date:a.toJSON()}),e.editLog=a.toJSON()):e.editLog=e.cookRecipe.notes[s].date,t.redraw(),i()}),permitted:p.permitted(r.Cook,!0)&&e.cookRecipe.id!==null,requireOnline:!0})]),t("div",[e.cookRecipe.notes!==void 0&&e.cookRecipe.notes!==null?e.cookRecipe.notes.map((i,a)=>t("div",[t(fe,{buttonLeft:{icon:e.editLog===e.cookRecipe.notes[a].date?c.Cancel:c.Delete,name:e.editLog===e.cookRecipe.notes[a].date?o.translate(L):o.translate(P),onclick:async()=>{if(e.editLog===e.cookRecipe.notes[a].date){e.editLog=null;return}return e.cookRecipe.notes.splice(a,1),n.update(e.cookRecipe).then(()=>{e.editLog=null,e.cookRecipe=n.findID(e.cookRecipe.id)})},permitted:p.permitted(r.Cook,!0)&&e.cookRecipe.id!==null,requireOnline:!0},buttonRight:{icon:e.editLog===e.cookRecipe.notes[a].date?c.Save:c.Edit,name:e.editLog===e.cookRecipe.notes[a].date?o.translate(T):o.translate(O),onclick:async()=>{if(e.editLog===e.cookRecipe.notes[a].date)return n.update(e.cookRecipe).then(()=>{e.editLog=null,e.cookRecipe=n.findID(e.cookRecipe.id)});e.editLog=e.cookRecipe.notes[a].date},permitted:p.permitted(r.Cook,!0)&&e.cookRecipe.id!==null,requireOnline:!0},name:R.fromString(e.cookRecipe.notes[a].date).toString(o.data().preferences.formatDateOrder,o.data().preferences.formatDateSeparator)}),t("div.CookRecipesID__wrap",[t("div.CookRecipesID__wrap",[t(b,{disabled:e.editLog!==e.cookRecipe.notes[a].date,iconSelect:c.RatingSelect,iconUnselect:c.RatingUnselect,idPostfix:`${a}`,max:5,name:o.translate(v),onclick:s=>{e.cookRecipe.notes[a].complexity=s},tooltip:o.translate(W),value:e.cookRecipe.notes[a].complexity}),t(b,{disabled:e.editLog!==e.cookRecipe.notes[a].date,iconSelect:c.RatingSelect,iconUnselect:c.RatingUnselect,idPostfix:`${a}`,max:5,name:o.translate(h),onclick:s=>{e.cookRecipe.notes[a].rating=s},tooltip:o.translate(w),value:e.cookRecipe.notes[a].rating})]),t("div.CookRecipesID__wrap",[t(l,{name:o.translate(De),textArea:{disabled:e.editLog!==e.cookRecipe.notes[a].date,oninput:s=>{e.cookRecipe.notes[a].note=s},value:e.cookRecipe.notes[a].note},tooltip:o.translate(Ie)})])])])):[]])])])]}}export{_e as CookRecipesID};
