import{ct as c,S as l,bB as f,m as i,A as p,a0 as u,c as o,co as w,cu as h,ab as F,I as s,cv as M,ah as b,ai as g,cw as G,cx as A,cy as V,ad as W,cz as D,cA as L,T as d,af as x,y as N,cB as v,cC as O,cD as E,cE as $,cF as q,cG as B,a as H,by as _,cH as y,bz as j,ck as z,bK as X,bI as K,am as Y,b2 as S}from"./index-09c2e996.js";import{C as J,F as Q}from"./FormImportCSV-767bd78d.js";import{F as U}from"./Filter-01c23926.js";import{F as Z}from"./FormImportRecipe-035ef431.js";import{F as ee}from"./FormShopItemIngredients-5475d1d1.js";import{T as te}from"./TableColumnHousehold-f6fe7c15.js";import{G as ae}from"./GetHelp-610c77dd.js";async function oe(k,r){const t=await J.import(k);if(t!==null)for(const n of t.data){const e={...c.new(),directions:n[r.Directions],ingredients:n[r.Ingredients],name:n[r.Name],servings:n[r.Servings],source:n[r.Source],tags:n[r.Tags].split(",")};if(r["Cook Time"]!==""){const a=parseInt(n[r["Cook Time"]]);isNaN(a)||(e.timeCook=a)}if(r.Complexity!==""){const a=parseInt(n[r.Complexity]);isNaN(a)||(e.complexity=a)}if(r["Prep Time"]!==""){const a=parseInt(n[r["Prep Time"]]);isNaN(a)||(e.timePrep=a)}if(r.Rating!==""){const a=parseInt(n[r.Rating]);isNaN(a)||(e.rating=a)}await c.create(e)}}function pe(){function k(e,a){return!!(e!==null&&e.toLowerCase().includes(a))}function r(){return{view:e=>i("div",{style:{"align-items":"flex-start",display:"flex","flex-direction":"column",width:"100%"}},[i("div.CookRecipes__name",[e.attrs.name,p.isSessionOnline()?i(_,{classes:"GlobalButtonIconAdd",icon:s.Add,id:`cookrecipe_${y(e.attrs.name)}`,onclick:async a=>{a.stopPropagation(),p.setComponentsDropdownMenu(`cookrecipe_${y(e.attrs.name)}`,a.clientY)}}):[],i(j,{id:`cookrecipe_${y(e.attrs.name)}`,items:[{icon:s.CookMealPlan,name:o.translate(z),onclick:()=>{p.setLayoutAppForm(X,{...f.new(),cookRecipeID:e.attrs.id})},permitted:b.permitted(g.Cook,!0,e.attrs.authHouseholdID),requireOnline:!0},{icon:s.ShopItem,name:o.translate(K),onclick:()=>{i.redraw.sync(),t.cookMealPlan=f.new(),t.cookMealPlan.cookRecipeID=e.attrs.id,t.formVisible=4},permitted:b.permitted(g.Shop,!0,e.attrs.authHouseholdID),requireOnline:!0}]})]),i(Y,{icon:s.Tag,name:"tags",onclick:a=>{t.tag()===a?t.tag(""):t.tag(a)},selected:()=>[t.tag()],small:!0,value:e.attrs.tags})])}}const t={columns:l({}),cookMealPlan:f.new(),deleted:l(!1),formImportCSVFields:{Complexity:"","Cook Time":"",Directions:"",Ingredients:"",Name:"","Prep Time":"",Rating:"",Servings:"",Source:"",Tags:""},formVisible:0,search:l(""),sort:l({formatter:e=>e.name,invert:!1,property:"name"}),tag:l("")};let n;return{oninit:async()=>{if(S.spanStart("CookRecipes"),n=l.lift((e,a,m,C,R,T)=>{const P=c.filter(e,m,"",C,T,I=>I.name.toLowerCase().includes(C.toLowerCase())||k(I.ingredients,C.toLowerCase()));return i.redraw(),U.array(P.data,a,R)},c.data,t.columns,t.deleted,t.search,t.sort,t.tag),i.route.param().tag!==void 0&&t.tag(i.route.param().tag),Object.keys(t.columns()).length===0)switch(p.getSessionDisplay()){case u.XLarge:t.columns({image:"",name:"",time:"",rating:"",cookMealPlanLast:"",cookMealPlanCount:""});break;case u.Large:t.columns({image:"",name:"",time:"",rating:"",cookMealPlanLast:""});break;case u.Medium:case u.Small:case u.XSmall:t.columns({image:"",name:"",rating:""});break}p.setLayoutApp({...ae("cook"),breadcrumbs:[{link:"/cook/recipes",name:o.translate(w)},{name:o.translate(h)}],toolbarActionButtons:[F().newCookRecipe,{icon:s.ImportExport,name:o.translate(M),onclick:()=>{t.formVisible=3},permitted:b.permitted(g.Cook,!0),requireOnline:!0},{icon:s.ImportExport,name:o.translate(G),onclick:()=>{t.formVisible=2},permitted:b.permitted(g.Cook,!0),requireOnline:!0}]}),S.spanEnd("CookRecipes")},onremove:()=>{n.end(!0)},view:()=>[i(Q,{fields:t.formImportCSVFields,oninput:(e,a)=>{t.formImportCSVFields[e]=a},onsubmit:async e=>{await oe(e,t.formImportCSVFields)},title:o.translate(A),toggle:e=>{t.formVisible=e?2:0},visible:t.formVisible===2}),i(Z,{toggle:e=>{t.formVisible=e?3:0},visible:t.formVisible===3}),i(ee,{cookMealPlans:[t.cookMealPlan],toggle:e=>{t.formVisible=e?4:0},visible:t.formVisible===4}),i(H,{actions:[{icon:s.Delete,name:o.translate(V),onclick:async()=>new Promise(e=>(t.tag(""),t.deleted(!t.deleted()),e())),permitted:b.permitted(g.Cook,!0),requireOnline:!1,secondary:t.deleted()}],data:n(),editOnclick:e=>{i.route.set(`/cook/recipes/${e.id}`)},filters:[{icon:s.Tag,name:o.translate(W),onclick:e=>{t.tag()===e?t.tag(""):t.tag(e)},selected:()=>[t.tag()],value:c.tagNames()}],loaded:c.isLoaded(),search:{onsearch:e=>{t.search(e)},placeholder:o.translate(D)},sort:t.sort,tableColumns:[{name:o.translate(L),noFilter:!0,noSort:!0,property:"image",type:d.Image},{name:o.translate(x),property:"name",render:r,sortFormatter:e=>e.name},{name:o.translate(N),noFilter:!0,property:"created",type:d.Timestamp},{name:o.translate(v),property:"servings"},{formatter:e=>e.timeCook+e.timePrep,name:o.translate(O),property:"time",type:d.Duration},{formatter:e=>{let a="";for(let m=1;m<6;m++)m<=e.rating&&(a+=`${s.RatingSelect} `);return a},name:o.translate(E),property:"complexity",type:d.Icon},{formatter:e=>`${s.RatingSelect} `.repeat(e.rating),name:o.translate($),property:"rating",type:d.Icon},{formatter:e=>e.cookMealPlanLast===null?"Never":e.cookMealPlanLast,name:o.translate(q),noFilter:!0,property:"cookMealPlanLast"},{name:o.translate(B),property:"cookMealPlanCount"},te()],tableColumnsNameEnabled:t.columns})]}}export{pe as CookRecipes};
