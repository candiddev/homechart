import{m as r,az as s,by as W,I as d,A as u,bz as Q,S as R,bA as C,bB as h,bC as S,Z as m,c as e,bD as k,ah as l,bE as M,aB as E,bF as ee,bG as ae,ab as D,bH as J,bI as T,ai as p,bJ as F,bK as H,bL as L,bM as $,bN as te,bO as G,bP as re,bQ as ne,bR as oe,bS as q,bT as U,bU as le,bV as de,bW as se,bX as ie,a0 as ce,bs as me,bY as ue,D as b,bZ as w,b_ as pe,b$ as fe,c0 as Ce,c1 as x,b1 as he,c2 as ye,c3 as ve,c4 as be,b as P,r as A,F as N,c5 as B,k as ge,c6 as ke,aY as _,c7 as Se,c8 as Oe,c9 as Ie,a as De,af as j,ca as Y,T as we,cb as _e,cc as Re,q as Pe,s as Ae,t as K,i as Ne,cd as We,ce as Me,cf as Ee,cg as Je,ch as Te,ci as Fe,cj as He,ck as Le,cl as $e,cm as Ge,a8 as qe,b2 as V}from"./index-09c2e996.js";import{O as Ue}from"./Or-b4de5444.js";import{C as xe}from"./CalendarDayEvent-2f2e8467.js";import{F as Be}from"./FormShopItemIngredients-5475d1d1.js";import{G as je}from"./GetHelp-610c77dd.js";import"./Filter-01c23926.js";function Ye(){return{view:i=>r("div.CalendarDay__container#calendar-day",{class:i.attrs.picker.month===i.attrs.date.month?void 0:"CalendarDay__container--outside",key:i.attrs.date.valueOf()},[r("div.CalendarDay__date",{class:s.now().valueOf()===i.attrs.date.valueOf()?"CalendarDay__date--today":void 0},[r("span",i.attrs.date.day),r(W,{classes:"GlobalButtonIconAdd",icon:d.Add,id:`calendarday_${i.attrs.date}`,onclick:async y=>{y.stopPropagation(),u.setComponentsDropdownMenu(`calendarday_${i.attrs.date.toJSON()}`,y.clientY)}}),r(Q,{id:`calendarday_${i.attrs.date.toJSON()}`,items:i.attrs.dropdownItems})]),r("div.CalendarDay__items",i.attrs.events.map(y=>r(xe,{date:i.attrs.date,event:y,loaded:i.attrs.loaded})))])}}const Ke=R({name:"",url:"",hidden:""}),a={dateRange:{from:s.now(),to:s.now()},display:R("week"),form:0,formCalendarICalendar:{data:C.new(),visible:!1},formCookMealPlan:h.new(),formHealthLogsState:{authAccountID:null,date:null,logs:[]},formICalendarTasks:!0,formPlanTask:S.new(),formShopItemIngredients:[],from:s.now().toYearMonth(),next:s.now(),picker:R(s.now().toYearMonth()),previous:s.now(),today:s.now()};function aa(){function i(o){o?a.form=7:a.form=0}function y(o){switch(a.display()){case"day":const t=a.dateRange;t.from=o.toCivilDate(),t.to=s.fromString(t.from.toJSON()),a.dateRange=t;const n=m.fromString(o.toString());n.addDays(1),a.next=n.toCivilDate(),n.addDays(-2),a.previous=n.toCivilDate();break;case"month":a.dateRange=o.toCivilDateRangeCalendar(e.data().preferences.formatWeek8601),o.addDays(15);const c=m.fromString(o.toString());c.addMonths(1),a.next=c.toCivilDate(),a.next.day=1,c.addMonths(-2),a.previous=c.toCivilDate(),a.previous.day=1;break;default:a.dateRange=o.toCivilDateRangeWeek(e.data().preferences.formatWeek8601),a.next=m.fromCivilDate(a.dateRange.from).toCivilDateWeekFrom(!1),a.previous=m.fromCivilDate(a.dateRange.to).toCivilDateWeekFrom(!0)}}function z(o){a.formShopItemIngredients=qe(o),i(!0)}function X(){const o=k.new();a.dateRange.from.toJSON()===a.dateRange.to.toJSON()?o.dateStart=a.dateRange.to.toJSON():o.dateStart=m.now().toCivilDate().toJSON();const t=m.now();return t.addMinutes(-1*t.timestamp.getMinutes()+60),o.timeStart=t.toCivilTime().toString(!0),o}const O=R.lift((o,t,n,c,v,g,I)=>{const f=m.fromCivilDate(s.fromString(`${g.getYear()}-${g.getMonth()}-01`)).toCivilDateRangeCalendar(e.data().preferences.formatWeek8601);g!==a.from&&(a.from=g,y(m.fromCivilDate(s.fromString(`${g.getYear()}-${g.getMonth()}-01`))));const Z=[I.preferences.hideCalendarEvents?[]:k.findDateRange(f.from,f.to)(),l.hideComponentIncludes("Health")?[]:M.findDateRange(f.from,f.to)(),I.preferences.hideCalendarBudgetRecurrences||l.hideComponentIncludes("Budget")?[]:E.findDateRange(f.from,f.to)(),I.preferences.hideCalendarCookMealPlans||l.hideComponentIncludes("Cook")?[]:h.findDateRange(f.from,f.to)(),I.preferences.hideCalendarPlanTasks||l.hideComponentIncludes("Plan")?[]:S.findDateRange(f.from,f.to)()];return r.redraw(),Z},k.data,h.data,M.data,ee.data,S.data,a.picker,e.data);return{oninit:async()=>{V.spanStart("Calendar"),u.setLayoutApp({...je("calendar"),breadcrumbs:[{name:e.translate(ae)}],toolbarActionButtons:[{...D().newCalendarEvent,onclick:()=>{u.setLayoutAppForm(J,{...k.new(),dateStart:a.dateRange.from.toJSON()===a.dateRange.to.toJSON()?a.dateRange.to.toJSON():s.now().toJSON()})}},{icon:d.ShopItem,name:e.translate(T),onclick:()=>{a.formShopItemIngredients=h.data().filter(t=>{const n=s.fromString(t.date);return n<=a.dateRange.to&&n>=a.dateRange.from}),i(!0)},permitted:l.permitted(p.Shop,!0)&&!l.hideComponentIncludes("Shop"),requireOnline:!0},{...D().newHealthLogs,onclick:()=>{u.setLayoutAppForm(F,{authAccountID:e.data().id,date:a.dateRange.from.toJSON()===a.dateRange.to.toJSON()?a.dateRange.to.toJSON():s.now().toJSON(),id:null,logs:[]})}},{...D().newCookMealPlan,onclick:()=>{u.setLayoutAppForm(H,{...h.new(),date:a.dateRange.from.toJSON()===a.dateRange.to.toJSON()?a.dateRange.to.toJSON():s.now().toJSON()})}},{...D().newPlanTask,onclick:()=>{u.setLayoutAppForm(L,{...S.new(),dueDate:a.dateRange.from.toJSON()===a.dateRange.to.toJSON()?m.fromCivilDate(a.dateRange.to).toString():[]})}}]}),r.route.param().display!==void 0&&a.display(r.route.param().display),r.route.param().display===void 0&&u.getSessionDisplay()===0&&a.display("day");let o=m.now();(r.route.param().from!==void 0||r.route.param().from==="")&&(o=m.fromCivilDate(s.fromString(r.route.param().from))),a.picker(o.toCivilDate().toYearMonth()),y(o),V.spanEnd("Calendar")},view:()=>{const o=E.isLoaded()&&k.isLoaded()&&h.isLoaded()&&S.isLoaded();return[r("div.Calendar__picker",[r("div.Calendar__title-container#picker-title",[r(W,{icon:d.Previous,onclick:async()=>{a.picker(a.picker().addMonths(-1))}}),r("input.FormItem__field.Calendar__title",{oninput:t=>{if(t.target.value!==""){const n=a.picker();n.fromInput(t.target.value),a.picker(n)}},type:"month",value:a.picker().toValue()}),r(W,{icon:d.Next,onclick:async()=>{a.picker(a.picker().addMonths(1))}})]),r("div.Calendar__calendar.Calendar__calendar--picker#picker",[$.getValues(e.data().preferences.formatWeek8601).map(t=>r("span.Calendar__date.Calendar__date--day",{key:t},r("span",t[0]))),m.getCivilDatesFromDateRange(m.fromCivilDate(s.fromString(`${a.picker().getYear()}-${a.picker().getMonth()}-01`)).toCivilDateRangeCalendar(e.data().preferences.formatWeek8601)).map(t=>r(r.route.Link,{class:te({Calendar__date:!0,"Calendar__date--active":t.valueOf()===a.dateRange.from.valueOf()&&t.valueOf()===a.dateRange.to.valueOf()||t.valueOf()>=a.dateRange.from.valueOf()&&t.valueOf()<=a.dateRange.to.valueOf(),"Calendar__date--active-end":t.valueOf()===a.dateRange.to.valueOf(),"Calendar__date--active-start":t.valueOf()===a.dateRange.from.valueOf(),"Calendar__date--outside":t.getMonth()!==a.picker().getMonth(),"Calendar__date--today":t.valueOf()===a.today.valueOf()}),href:`${r.parsePathname(r.route.get()).path}?display=${a.display()}&from=${t.toJSON()}`,key:t.valueOf(),options:{state:{key:Date.now()}}},[t.day,r("div",O().map(n=>n[t.toJSON()]===void 0?[]:r("span",{style:{color:n[t.toJSON()][0].color===G.Default||n[t.toJSON()][0].id!==null?"var(--color_primary)":`var(--color_${re.getValue(n[t.toJSON()][0].color).toLowerCase()})`}},"â€¢")))]))])]),r("div.Calendar__container",[r(ne,{buttonLeft:{href:`${r.buildPathname(r.parsePathname(r.route.get()).path,{display:a.display(),from:a.previous.toJSON()})}`,icon:d.Previous,name:a.previous.toString(e.data().preferences.formatDateOrder,e.data().preferences.formatDateSeparator),permitted:!0,requireOnline:!0},buttonRight:{href:`${r.buildPathname(r.parsePathname(r.route.get()).path,{display:a.display(),from:a.next.toJSON()})}`,icon:d.Next,iconRight:!0,name:a.next.toString(e.data().preferences.formatDateOrder,e.data().preferences.formatDateSeparator),permitted:!0,requireOnline:!0},name:a.display()==="month"?a.picker().toString():u.formatCivilDate(a.dateRange.from)}),r(oe,{actions:[{icon:d.Calendar,name:e.translate(q),onclick:async()=>new Promise(t=>(a.form=3,t())),permitted:!0,primary:!0,requireOnline:!0},{accent:!0,icon:d.Calendar,name:e.translate(U),onclick:async()=>new Promise(t=>(a.form=1,t())),permitted:!0,requireOnline:!0,secondary:!0}],filters:[{name:e.translate(le),onclick:t=>{r.route.set(r.parsePathname(r.route.get()).path,{display:t==="today"?a.display():t,from:t==="today"?a.today:r.route.param().from},{state:{key:Date.now()}})},selected:()=>[a.today.valueOf()>=a.dateRange.from.valueOf()&&a.today.valueOf()<=a.dateRange.to.valueOf()?"today":"",a.display()],value:[{id:"today",name:e.translate(de)},{id:"day",name:e.translate(se)},{id:"week",name:e.translate(ie)},...u.getSessionDisplay()===ce.XLarge?[{id:"month",name:e.translate(me)}]:[]]},{name:e.translate(ue),onclick:async t=>{if(t.startsWith("health"))await e.hideCalendarHealthLogs(b.findMember(t.replace("health_","")).id);else switch(t){case"events":return e.update({...e.data(),preferences:{...e.data().preferences,hideCalendarEvents:!e.data().preferences.hideCalendarEvents}},!0);case"meals":return e.update({...e.data(),preferences:{...e.data().preferences,hideCalendarCookMealPlans:!e.data().preferences.hideCalendarCookMealPlans}},!0);case"tasks":return e.update({...e.data(),preferences:{...e.data().preferences,hideCalendarPlanTasks:!e.data().preferences.hideCalendarPlanTasks}},!0);case"transactions":return e.update({...e.data(),preferences:{...e.data().preferences,hideCalendarBudgetRecurrences:!e.data().preferences.hideCalendarBudgetRecurrences}},!0)}},selected:()=>[e.data().preferences.hideCalendarEvents?"":"events",...b.members().map(t=>e.data().preferences.hideCalendarHealthLogs.includes(`${t.id}`)?"":`health_${t.name}`),e.data().preferences.hideCalendarCookMealPlans?"":"meals",e.data().preferences.hideCalendarPlanTasks?"":"tasks",e.data().preferences.hideCalendarBudgetRecurrences?"":"transactions"],value:[{color:w.calendarEvent(e.data().preferences.colorPrimary),icon:d.Calendar,id:"events",name:e.translate(pe)},...l.hideComponentIncludes("Health")?[]:b.findMemberNames(null,!0).map(t=>{const n=b.findMember(t);return{color:n.color,icon:d.Health,id:`health_${n.name}`,name:`${e.translate(fe)} - ${n.name}`}}),...l.hideComponentIncludes("Cook")?[]:[{color:w.cookMealPlan(b.findID(e.data().primaryAuthHouseholdID).preferences.colorCookMealPlanEvents),icon:d.CookMealPlan,id:"meals",name:e.translate(Ce)}],...l.hideComponentIncludes("Plan")?[]:[{color:w.planTask(b.findID(e.data().primaryAuthHouseholdID).preferences.colorPlanTaskEvents,G.Default),icon:d.PlanTask,id:"tasks",name:e.translate(x)}],...l.hideComponentIncludes("Budget")?[]:[{color:w.budgetRecurrrence(b.findID(e.data().primaryAuthHouseholdID).preferences.colorBudgetRecurrenceEvents),icon:d.BudgetTransaction,id:"transactions",name:e.translate(he)}]]},{name:e.translate(ye),onclick:async t=>{switch(t){case"astronomy":return e.update({...e.data(),preferences:{...e.data().preferences,showCalendarEventAstronomy:!e.data().preferences.showCalendarEventAstronomy}},!0);case"holidays_CA":return e.update({...e.data(),preferences:{...e.data().preferences,showCalendarEventHolidaysCA:!e.data().preferences.showCalendarEventHolidaysCA}},!0);case"holidays_UK":return e.update({...e.data(),preferences:{...e.data().preferences,showCalendarEventHolidaysUK:!e.data().preferences.showCalendarEventHolidaysUK}},!0);case"holidays_US":return e.update({...e.data(),preferences:{...e.data().preferences,showCalendarEventHolidaysUS:!e.data().preferences.showCalendarEventHolidaysUS}},!0);default:const n=C.data().find(c=>c.name===t);if(n!==void 0&&n.id!==null)return e.update({...e.data(),hideCalendarICalendars:ve(n.id,e.data().hideCalendarICalendars)})}},selected:()=>[e.data().preferences.showCalendarEventAstronomy?"astronomy":"",e.data().preferences.showCalendarEventHolidaysCA?"holidays_CA":"",e.data().preferences.showCalendarEventHolidaysUK?"holidays_UK":"",e.data().preferences.showCalendarEventHolidaysUS?"holidays_US":"",...C.data().filter(t=>!e.data().hideCalendarICalendars.includes(`${t.id}`)).map(t=>t.name)],value:[{id:"astronomy",name:e.translate(be)},{id:"holidays_CA",name:"Holidays - CA"},{id:"holidays_UK",name:"Holidays - UK"},{id:"holidays_US",name:"Holidays - US"},...C.names()]}]}),a.form===1?r(P,{buttons:[{name:e.translate(A),onclick:async()=>new Promise(t=>(a.form=0,t())),permitted:!0,requireOnline:!0}],overlay:!0,title:{name:e.translate(U)}},[r(N,{name:"Homechart iCalendar URL",textArea:{disabled:!0,oninput:()=>{},value:e.data().icalendarID===null?"iCalendar access disabled.":`<${B().hostname===""?document.location.origin:B().hostname}/api/v1/icalendar/${e.data().icalendarID}.ics${a.formICalendarTasks?"":"?plantasks=no"}>`},tooltip:""}),e.data().icalendarID===null?[]:r(ge,{name:`${e.translate(ke)} ${e.translate(x)}`,onclick:()=>{a.formICalendarTasks=!a.formICalendarTasks},value:a.formICalendarTasks}),r(_,{accent:!0,name:e.translate(Se),onclick:async()=>e.deleteICalendarID(),permitted:l.permitted(p.Auth,!0)&&e.data().icalendarID!==null,requireOnline:!0}),r(_,{name:e.data().icalendarID===null?e.translate(Oe):e.translate(Ie),onclick:async()=>e.updateICalendarID().then(()=>{r.redraw()}),permitted:l.permitted(p.Auth,!0),primary:!0,requireOnline:!0})]):[],a.form===3?r(P,{buttons:[{name:e.translate(A),onclick:async()=>new Promise(t=>(a.form=0,t())),permitted:!0,requireOnline:!1}],overlay:!0,title:{name:e.translate(q)}},[r(De,{actions:[],data:C.data(),editOnclick:t=>{a.formCalendarICalendar.data=t,a.formCalendarICalendar.visible=!0},filters:[],id:"icalendars",loaded:!0,noFilters:!0,noNewButton:!0,staticColumns:!0,tableColumns:[{name:e.translate(j),noFilter:!0,property:"name"},{name:e.translate(Y),noFilter:!0,property:"url",type:we.Link}],tableColumnsNameEnabled:Ke,title:{name:e.translate(_e)}}),r(_,{icon:d.Add,name:e.translate(Re),onclick:async()=>new Promise(t=>(a.formCalendarICalendar={data:C.new(),visible:!0},t())),permitted:!0,primary:!0,requireOnline:!0}),a.formCalendarICalendar.visible?r(P,{buttons:[{accent:!0,name:e.translate(Pe),onclick:async()=>C.delete(a.formCalendarICalendar.data.id).then(()=>{a.formCalendarICalendar.visible=!1}),permitted:a.formCalendarICalendar.data.id!==null&&l.permitted(p.Calendar,!0,a.formCalendarICalendar.data.authHouseholdID),requireOnline:!1},{name:e.translate(A),onclick:async()=>new Promise(t=>(a.formCalendarICalendar.visible=!1,t())),permitted:!0,requireOnline:!1},{name:a.formCalendarICalendar.data.id===null?e.translate(Ae):e.translate(K),onclick:async()=>a.formCalendarICalendar.data.id===null?C.create(a.formCalendarICalendar.data).then(()=>{a.formCalendarICalendar.visible=!1}):C.update(a.formCalendarICalendar.data).then(()=>{a.formCalendarICalendar.visible=!1}),permitted:l.permitted(p.Calendar,!0,a.formCalendarICalendar.data.authHouseholdID),primary:!0,requireOnline:!1}],overlay:!0,title:{name:`${a.formCalendarICalendar.data.id===null?e.translate(Ne):e.translate(K)} ${e.translate(We)}`}},[r(Me,{item:a.formCalendarICalendar.data,permissionComponent:p.Calendar}),r(N,{input:{oninput:t=>{a.formCalendarICalendar.data.name=t},required:!0,type:"text",value:a.formCalendarICalendar.data.name},name:e.translate(j),tooltip:e.translate(Ee)}),a.formCalendarICalendar.data.ics===""?[r(N,{input:{oninput:t=>{a.formCalendarICalendar.data.url=t},type:"url",value:a.formCalendarICalendar.data.url},name:e.translate(Y),tooltip:e.translate(Je)}),r(Ue)]:[],r(_,{accept:"text/calendar",name:a.formCalendarICalendar.data.ics===""?e.translate(Te):e.translate(Fe),oninput:async t=>{const n=new FileReader;n.onload=async()=>{typeof n.result=="string"&&(a.formCalendarICalendar.data.ics=n.result,r.redraw())},n.readAsText(t)},permitted:!0,primary:!0,requireOnline:!0})]):[]]):[],r(Be,{cookMealPlans:a.formShopItemIngredients,toggle:i,visible:a.form===7}),r("div.Calendar__calendar#calendar",[a.display()==="day"?[]:$.getValues(e.data().preferences.formatWeek8601).map(t=>r("div.CalendarDay__container.CalendarDay__container--day",r("p",t))),m.getCivilDatesFromDateRange(a.dateRange).map((t,n)=>r(Ye,{date:t,dropdownItems:[{icon:d.Calendar,name:e.translate(He),onclick:()=>{u.setLayoutAppForm(J,{...X(),dateStart:t.toJSON()})},permitted:l.permitted(p.Calendar,!0),requireOnline:!0},{icon:d.CookMealPlan,name:e.translate(Le),onclick:()=>{u.setLayoutAppForm(H,{...h.new(),date:t.toJSON()})},permitted:l.permitted(p.Cook,!0),requireOnline:!0},{icon:d.Health,name:e.translate($e),onclick:()=>{u.setLayoutAppForm(F,{authAccountID:e.data().id,date:t.toJSON(),id:null,logs:[]})},permitted:l.permitted(p.Health,!0),requireOnline:!0},{icon:d.PlanTask,name:e.translate(Ge),onclick:()=>{u.setLayoutAppForm(L,{...S.new(),authAccountID:e.data().id,dueDate:m.fromCivilDate(t).toString()})},permitted:l.permitted(p.Plan,!0),requireOnline:!0},{icon:d.ShopItem,name:e.translate(T),onclick:()=>{z(h.data().filter(c=>c.date===t.toJSON()))},permitted:l.permitted(p.Shop,!0)&&O()[2][t.toJSON()]!==void 0&&O()[2][t.toJSON()].length>0,requireOnline:!0}],events:o?O().map(c=>{let v=[];return c[t.toJSON()]!==void 0&&(v=v.concat(c[t.toJSON()])),v}).flat().sort((c,v)=>c.timestampStart===v.timestampStart?0:c.timestampStart>v.timestampStart?1:-1):[...Array(n===0?3:n===1?2:n===2?1:0)].map(()=>k.new()),loaded:o,picker:a.picker()}))])])]}}}export{aa as Calendar};
