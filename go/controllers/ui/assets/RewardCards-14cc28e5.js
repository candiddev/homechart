import{S as h,c as a,m as t,e_ as s,D as b,A as w,e$ as f,f0 as A,f1 as v,ab as G,bQ as g,I as l,aY as m,i as k,f2 as S,f3 as R,ah as i,ai as o,b as C,f4 as O,f5 as W,f6 as q,q as F,f7 as I,f8 as L,f9 as P,d9 as T,b2 as _}from"./index-09c2e996.js";import{T as D}from"./TitleTabsAuthHouseholds-59423851.js";import{G as H}from"./GetHelp-610c77dd.js";function N(n){return n.invert||n.stampCount===n.stampGoal}function p(n){return n.senders.includes(`${a.data().id}`)}function B(){const n={household:h(a.data().primaryAuthHouseholdID)};let u;return{oninit:async()=>{_.spanStart("RewardCards"),u=h.lift((r,c)=>{let d=[];switch(t.route.param().filter){case"sent":d=s.findSent(r,t.route.param().to);break;case"inprogress":d=s.getInProgress(r);break;case"redeemable":d=s.getRedeemable(r);break;default:d=r}return b.data().length>1&&(d=d.filter(y=>y.authHouseholdID===c)),d},s.data,n.household);let e="";t.route.param().filter!==void 0&&(e=t.route.param().filter),t.route.param().household===void 0?t.route.param().household=n.household():n.household(t.route.param().household),w.setLayoutApp({...H("reward"),breadcrumbs:e===""||e==="all"?[{name:a.translate(f)}]:[{link:"/reward/all",name:a.translate(f)},{link:e==="sent"&&t.route.param().to!==void 0?"/sent":void 0,name:e==="inprogress"?a.translate(A):v(e)}],toolbarActionButtons:[G().newRewardCard]}),_.spanEnd("RewardCards")},onremove:()=>{u.end(!0)},view:()=>[t(g,{class:"RewardCards__title",loaded:s.isLoaded(),tabs:D()}),u().length===0?t(C,{loaded:s.isLoaded()},[t("i.RewardCards__empty-icon",l.NotFound),t("p.RewardCards__empty","No Cards found"),t(m,{icon:l.Add,name:`${a.translate(k)} ${a.translate(S)}`,onclick:async()=>new Promise(e=>(w.setLayoutAppForm(R,s.new()),e())),permitted:i.permitted(o.Reward,!0),primary:!0,requireOnline:!0})]):u().map(e=>t(C,{classes:["RewardCards__form"],title:{buttonLeft:{disabled:!0,icon:N(e)?l.Redeemable:l.InProgress,iconOnly:!0,name:a.translate(P),onclick:async()=>{},permitted:!0,requireOnline:!1},buttonRight:{icon:l.Edit,name:a.translate(T),onclick:async()=>new Promise(r=>(w.setLayoutAppForm(R,e),r())),permitted:i.permitted(o.Reward,!0)&&p(e)||i.permitted(o.Auth,!0,n.household()),requireOnline:!0},name:e.name}},[t("div.RewardCards__card",[e.invert||e.details===""?[]:t("div.RewardCards__field",[t("p",a.translate(O)),t("p",e.details)]),t("div.RewardCards__field",[t("p",a.translate(f)),t("p.RewardCards__reward",e.reward)]),t("div.RewardCards__field",[t("p",a.translate(W)),t("p",e.senders.map(r=>b.findMemberName(r)).join(", "))]),e.recipients.length!==1||e.recipients.length===1&&e.recipients[0]===a.data().id?[]:t("div.RewardCards__field",[t("p",a.translate(q)),t("p",e.recipients.map(r=>b.findMemberName(r)).join(", "))])]),t("div.RewardCards__stamps",{onclick:async()=>s.punch(e)},Array.from(Array(e.stampGoal).keys()).map(r=>!e.invert&&r+1<=e.stampCount||e.invert&&r+1<=e.stampGoal-e.stampCount?t("span.RewardCards__stamp.RewardCards__stamp--stamped"):t("span.RewardCards__stamp"))),t("div.RewardCards__buttons",[t(m,{accent:!0,name:a.translate(F),onclick:async()=>s.delete(e.id),permitted:i.permitted(o.Auth,!0)||p(e)&&i.permitted(o.Reward,!0),requireOnline:!0}),t(m,{name:a.translate(I),onclick:async()=>(e.stampCount=0,s.update(e)),permitted:i.permitted(o.Auth,!0)||p(e)&&i.permitted(o.Reward,!0),requireOnline:!0}),t(m,{name:a.translate(L),onclick:async()=>s.delete(e.id),permitted:!e.invert&&e.stampCount===e.stampGoal&&(i.permitted(o.Auth,!0)||p(e)&&i.permitted(o.Reward,!0)),primary:!0,requireOnline:!0})])]))]}}export{B as RewardCards};
