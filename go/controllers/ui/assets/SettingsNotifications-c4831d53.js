import{c as e,S as H,D as b,a2 as P,al as h,gL as d,gM as p,gN as v,gO as D,gP as S,m as s,A as f,fR as N,a1 as I,F as k,gQ as T,gR as c,cr as r,Z as C,gS as $,a as E,dJ as W,gT as w,ah as m,ai as g,T as y,gU as x,o as u,gV as R,gW as G,b as M,b2 as A}from"./index-09c2e996.js";import{G as O}from"./GetHelp-610c77dd.js";function U(){const o={authAccount:e.data(),columns:H({type:"",device:"",email:""})};let l;return{oninit:async()=>{A.spanStart("SettingsNotifications"),l=b.data.map(t=>{const n=[{deviceProperty:null,emailProperty:"ignoreEmailNewsletter",type:e.translate(P)},{deviceProperty:"ignoreDeviceCalendarEvent",emailProperty:"ignoreEmailCalendarEvent",type:`${e.translate(h)} ${e.translate(d)}`},{deviceProperty:"ignoreDevicePlanTask",emailProperty:"ignoreEmailPlanTask",type:`${e.translate(h)} ${e.translate(p)}`}];for(const a of t)n.push({authHouseholdID:a.id,deviceProperty:"ignoreDeviceCalendarEvent",emailProperty:"ignoreEmailCalendarEvent",type:`${a.name} ${e.translate(d)}`},{authHouseholdID:a.id,deviceProperty:"ignoreDeviceCookMealPlanCook",emailProperty:"ignoreEmailCookMealPlanCook",type:`${a.name} ${e.translate(v)}`},{authHouseholdID:a.id,deviceProperty:"ignoreDeviceCookMealPlanPrep",emailProperty:"ignoreEmailCookMealPlanPrep",type:`${a.name} ${e.translate(D)}`},{authHouseholdID:a.id,deviceProperty:"ignoreDevicePlanTask",emailProperty:"ignoreEmailPlanTask",type:`${a.name} ${e.translate(p)}`},{authHouseholdID:a.id,deviceProperty:"ignoreDevicePlanTaskComplete",emailProperty:null,type:`${a.name} ${e.translate(S)}`});return s.redraw(),n}),f.setLayoutApp({...O("/using-homechart/platform/settings#notifications",!0),breadcrumbs:[{link:"/settings/account",name:e.translate(N)},{name:e.translate(I)}],toolbarActionButtons:[]}),A.spanEnd("SettingsNotifications")},onremove:()=>{l.end(!0)},view:()=>s(M,{buttons:[{accent:u.data().webPush!==null,name:u.data().webPush===null?e.translate(R):e.translate(G),onclick:async()=>u.toggleNotifications().then(()=>{"Notification"in window&&Notification.permission!=="granted"&&f.setLayoutAppAlert({message:"Your device is blocking notifications, please allow them for Homechart"})}),permitted:!0,primary:u.data().webPush===null,requireOnline:!0}]},[s(k,{name:e.translate(T),select:{oninput:async t=>{let n=null;if(t!==e.translate(c)){o.authAccount.dailyAgendaTime=r.fromString(`${`0${t}`.slice(-2)}:00`).toString(!0);const a=C.now();a.addDays(1);const i=r.fromString(t);a.timestamp.setHours(i.hour),a.timestamp.setMinutes(i.minute),n=a.toString()}return e.update({...o.authAccount,dailyAgendaNext:n}).then(()=>{o.authAccount=e.data(),s.redraw()})},options:[{name:e.translate(c)},...[...Array(24)].map((t,n)=>({id:`${n}`,name:r.fromString(`${`0${n}`.slice(-2)}:00`).toString(e.data().preferences.formatTime24)}))],value:o.authAccount.dailyAgendaNext===null?e.translate(c):r.fromString(o.authAccount.dailyAgendaTime).hour},tooltip:e.translate($)}),s(E,{actions:[],data:l(),filters:[],getKey:t=>t.type,id:"notifications",loaded:!0,noFilters:!0,tableColumns:[{name:e.translate(W),property:"type"},{checkboxOnclick:async t=>{const n=t.deviceProperty;if(n!==null){if(t.authHouseholdID===void 0)o.authAccount.preferences[n]=o.authAccount.preferences[n]===!1;else{(o.authAccount.preferences.notificationsHouseholds===null||o.authAccount.preferences.notificationsHouseholds.length===0)&&(o.authAccount.preferences.notificationsHouseholds=[{...e.newNotificationsHouseholds(),authHouseholdID:t.authHouseholdID}]);let a=o.authAccount.preferences.notificationsHouseholds.findIndex(i=>i.authHouseholdID===t.authHouseholdID);a<0&&(a=o.authAccount.preferences.notificationsHouseholds.push({...e.newNotificationsHouseholds(),authHouseholdID:t.authHouseholdID})-1),o.authAccount.preferences.notificationsHouseholds[a][n]=o.authAccount.preferences.notificationsHouseholds[a][n]===!1}return e.update(o.authAccount)}},formatter:t=>t.deviceProperty===null?"":t.authHouseholdID===void 0?!o.authAccount.preferences[t.deviceProperty]:!e.findNotificationsHousehold(o.authAccount.preferences.notificationsHouseholds,t.authHouseholdID)[t.deviceProperty],name:e.translate(w),permitted:()=>m.permitted(g.Auth,!0),property:"device",type:y.Checkbox},{checkboxOnclick:async t=>{const n=t.emailProperty;if(n!==null){if(t.authHouseholdID===void 0)o.authAccount.preferences[n]=o.authAccount.preferences[n]===!1;else{(o.authAccount.preferences.notificationsHouseholds===null||o.authAccount.preferences.notificationsHouseholds===void 0)&&(o.authAccount.preferences.notificationsHouseholds=[]);let a=o.authAccount.preferences.notificationsHouseholds.findIndex(i=>i.authHouseholdID===t.authHouseholdID);a<0&&(a=o.authAccount.preferences.notificationsHouseholds.push({...e.newNotificationsHouseholds(),authHouseholdID:t.authHouseholdID})-1),o.authAccount.preferences.notificationsHouseholds[a][n]=o.authAccount.preferences.notificationsHouseholds[a][n]===!1}return e.update(o.authAccount)}},formatter:t=>t.emailProperty===null?"":t.authHouseholdID===void 0?!o.authAccount.preferences[t.emailProperty]:!e.findNotificationsHousehold(o.authAccount.preferences.notificationsHouseholds,t.authHouseholdID)[t.emailProperty],name:e.translate(x),permitted:()=>m.permitted(g.Auth,!0),property:"email",type:y.Checkbox}],tableColumnsNameEnabled:o.columns})])}}export{U as SettingsNotifications};
